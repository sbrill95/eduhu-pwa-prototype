# Image Generation Modal - KORRIGIERTE Bildgenerierungs-Tasks

**Status**: ‚ö†Ô∏è IN PROGRESS - Requirements korrigiert (2025-10-03)
**Created**: 2025-10-02 (Original), 2025-10-03 (Korrigiert)
**Related**: [spec.md](spec.md) | [plan.md](plan.md)

---

## üî¥ WICHTIG: Requirements-Korrektur

Die urspr√ºnglichen Tasks basierten auf **FALSCHEN Requirements** (Thema/Lerngruppe/DAZ/Lernschwierigkeiten). Diese waren f√ºr **ARBEITSBLATT-Generierung**, nicht f√ºr **BILD-Generierung**.

**Korrekte Requirements f√ºr Bildgenerierung**:
1. Form-Felder: **Beschreibung** (Textarea) + **Bildstil** (Dropdown)
2. Buttons: **"Bild generieren"** + **"Zur√ºck zum Chat"**
3. Workflow: Confirmation ‚Üí Form ‚Üí Ladescreen ‚Üí Preview ‚Üí Animation ‚Üí Library
4. Auto-Tagging: Titel + Tags automatisch generieren

---

## Task Overview

**Total Tasks**: 18 (15 original + 3 neue)
**Estimated Total Time**: 14-16 hours
**Complexity**: Medium-High
**Risk Level**: Medium
**Status**: ‚ö†Ô∏è IN PROGRESS

---

## Task List

### Phase 1: Confirmation Message (2 hours) ‚úÖ TEILWEISE COMPLETED

#### TASK-001: Create AgentConfirmationMessage Component
**Status**: ‚úÖ `completed`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 1 hour
**Completed**: 2025-10-02

**Description**:
Create chat message component for agent confirmation prompts.

**Acceptance Criteria**:
- [x] File created: `AgentConfirmationMessage.tsx`
- [x] Renders confirmation card with button
- [x] Button calls `openModal()` with prefill data
- [x] Gemini-inspired design

**Status**: ‚úÖ **COMPLETED** - Component funktioniert korrekt

---

#### TASK-002: Write AgentConfirmationMessage Unit Tests
**Status**: ‚úÖ `completed`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 30 minutes
**Completed**: 2025-10-02

**Status**: ‚úÖ **COMPLETED** - Tests passing

---

#### TASK-003: Integrate Confirmation Message in ChatView
**Status**: ‚úÖ `completed`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 30 minutes
**Completed**: 2025-10-02

**Status**: ‚úÖ **COMPLETED** - Integration funktioniert

---

### Phase 2: Bild-Generierungs-Form (3 hours) ‚ùå MUSS NEU GEMACHT WERDEN

#### TASK-004: Update ImageGenerationFormData Type ‚ö†Ô∏è KORRIGIEREN
**Status**: ‚ùå `needs-rework`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 15 minutes

**Description**:
Update TypeScript interface f√ºr **BILD-Generierung** (nicht Arbeitsblatt!).

**ALTE Implementation** (FALSCH):
```typescript
interface ImageGenerationFormData {
  theme: string;
  learningGroup: string;
  dazSupport: boolean;
  learningDifficulties: boolean;
}
```

**NEUE Implementation** (KORREKT):
```typescript
interface ImageGenerationFormData {
  description: string;        // "Was soll das Bild zeigen?"
  imageStyle: string;         // "Realistisch" | "Cartoon" | "Illustrativ" | "Abstrakt"
}
```

**Acceptance Criteria**:
- [ ] File updated: `teacher-assistant/frontend/src/lib/types.ts`
- [ ] Interface `ImageGenerationFormData` mit KORREKTEN Feldern
- [ ] Export interface
- [ ] TypeScript compilation succeeds

**Files to Modify**:
- [ ] `teacher-assistant/frontend/src/lib/types.ts`

---

#### TASK-005: Redesign AgentFormView f√ºr Bildgenerierung ‚ö†Ô∏è KORRIGIEREN
**Status**: ‚ùå `needs-rework`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 2 hours

**Description**:
AgentFormView komplett umschreiben f√ºr **BILD-Generierung**.

**ALTE Implementation** (FALSCH - Arbeitsblatt):
- Header: "‚Üê Generieren"
- Fields: Thema, Lerngruppe, DaZ, Lernschwierigkeiten
- Button: "Idee entfalten ‚ú®"

**NEUE Implementation** (KORREKT - Bild):
- Header: "Bildgenerierung" (KEIN Zur√ºck-Pfeil, KEIN X!)
- Title: "Erstelle ein ma√ügeschneidertes Bild f√ºr deinen Unterricht."
- **Field 1**: "Was soll das Bild zeigen?" (Textarea, min-height 100px, vorausgef√ºllt)
- **Field 2**: "Bildstil" (Dropdown: Realistisch/Cartoon/Illustrativ/Abstrakt)
- **Button 1**: "Bild generieren" (Orange, full-width, startet Generierung)
- **Button 2**: "Zur√ºck zum Chat" (Text-only, gray, schlie√üt Modal)

**Acceptance Criteria**:
- [ ] File updated: `teacher-assistant/frontend/src/components/AgentFormView.tsx`
- [ ] 2 Form-Felder (Beschreibung + Bildstil)
- [ ] 2 Buttons ("Bild generieren" + "Zur√ºck zum Chat")
- [ ] KEIN X-Button
- [ ] KEIN Zur√ºck-Pfeil
- [ ] Gemini Design (Orange #FB6542, Teal #D3E4E6)
- [ ] Mobile-first responsive
- [ ] Pre-fill funktioniert

**Files to Modify**:
- [ ] `teacher-assistant/frontend/src/components/AgentFormView.tsx`

**Visual Verification**:
- [ ] Playwright Screenshot zeigt korrekte Form

---

#### TASK-006: Write AgentFormView Unit Tests ‚ö†Ô∏è ANPASSEN
**Status**: ‚ùå `needs-rework`
**Priority**: `P1` (High)
**Agent**: Frontend-Agent
**Estimate**: 45 minutes

**Description**:
Unit tests f√ºr NEUE Bild-Generierungs-Form.

**Acceptance Criteria**:
- [ ] Test: Renders "Beschreibung" textarea
- [ ] Test: Renders "Bildstil" dropdown
- [ ] Test: "Bild generieren" button exists
- [ ] Test: "Zur√ºck zum Chat" button exists
- [ ] Test: Pre-fill works for description
- [ ] Test: Submit calls API with correct data structure
- [ ] All tests passing (6+ tests)

**Files to Modify**:
- [ ] `teacher-assistant/frontend/src/components/AgentFormView.test.tsx`

---

### Phase 2.5: Ladescreen & Preview (NEU!) üÜï

#### TASK-016: Implement Ladescreen w√§hrend Generierung üÜï
**Status**: ‚è≥ `todo`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 1 hour

**Description**:
Ladescreen anzeigen w√§hrend Bildgenerierung l√§uft.

**Acceptance Criteria**:
- [ ] Component created: `AgentLoadingView.tsx` (oder in AgentProgressView integrieren)
- [ ] Zeigt Loading-Spinner (z.B. Ionic `ion-spinner`)
- [ ] Text: "Dein Bild wird erstellt..."
- [ ] Optional: Progress-Text wenn verf√ºgbar
- [ ] Keine User-Interaktion m√∂glich (no buttons)
- [ ] Gemini Design (Teal background)

**Files to Create/Modify**:
- [ ] `teacher-assistant/frontend/src/components/AgentProgressView.tsx` (oder neue Datei)

---

#### TASK-017: Implement Preview-Modal nach Generierung üÜï
**Status**: ‚è≥ `todo`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 1.5 hours

**Description**:
Preview-Modal √∂ffnet **AUTOMATISCH** nach erfolgreicher Bildgenerierung.

**Acceptance Criteria**:
- [ ] Modal √∂ffnet automatisch wenn Bild generiert
- [ ] Zeigt generiertes Bild (Fullscreen)
- [ ] Zeigt Badge: "‚úÖ In Library gespeichert"
- [ ] **2 Buttons**:
  - [ ] "Teilen üîó" (grauer Border, ruft Web Share API auf)
  - [ ] "Weiter im Chat üí¨" (orange, startet Animation)
- [ ] Gemini Design
- [ ] Mobile-first

**Implementation Notes**:
```typescript
const handleShare = async () => {
  if (navigator.share) {
    await navigator.share({
      title: 'Generiertes Bild',
      text: result.description,
      url: result.imageUrl
    });
  } else {
    await navigator.clipboard.writeText(result.imageUrl);
    toast.success('Link kopiert!');
  }
};
```

**Files to Modify**:
- [ ] `teacher-assistant/frontend/src/components/AgentResultView.tsx`

---

#### TASK-018: Auto-Save mit Titel + Tags in Library üÜï
**Status**: ‚è≥ `todo`
**Priority**: `P1` (High)
**Agent**: Backend-Agent + Frontend-Agent
**Estimate**: 2 hours

**Description**:
Bild automatisch in Library speichern mit generiertem Titel und Tags.

**Backend Part**:
- [ ] File updated: `teacher-assistant/backend/src/agents/langGraphImageGenerationAgent.ts`
- [ ] Funktion: `generateTitleAndTags(description: string)`
- [ ] Nutzt ChatGPT um Titel zu generieren (z.B. "Photosynthese Diagramm")
- [ ] Extrahiert Tags aus Beschreibung (z.B. ["Photosynthese", "Biologie", "Klasse 7"])
- [ ] Speichert in InstantDB mit Titel + Tags

**Frontend Part**:
- [ ] Tags sind NICHT sichtbar in Library UI
- [ ] Library-Suche nutzt Tags im Hintergrund
- [ ] User kann nach "Photosynthese" suchen ‚Üí Bild wird gefunden

**Acceptance Criteria**:
- [ ] Titel wird automatisch generiert
- [ ] 3-5 Tags werden extrahiert
- [ ] Tags helfen bei Suche
- [ ] Tags sind unsichtbar f√ºr User

**Files to Modify**:
- [ ] `teacher-assistant/backend/src/agents/langGraphImageGenerationAgent.ts`
- [ ] `teacher-assistant/backend/src/routes/materials.ts` (wenn n√∂tig)

---

### Phase 3: Result View Enhancement (2 hours) ‚úÖ TEILWEISE COMPLETED

#### TASK-007: Add "Teilen" and "Weiter im Chat" Buttons
**Status**: ‚ö†Ô∏è `needs-verification`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 1 hour
**Completed**: 2025-10-02

**Description**:
Update AgentResultView mit neuen Buttons.

**Status**: ‚ö†Ô∏è **NEEDS VERIFICATION** - Buttons existieren, aber Preview-Modal fehlt

---

#### TASK-008: Write AgentResultView Unit Tests
**Status**: ‚ö†Ô∏è `needs-verification`
**Priority**: `P1` (High)
**Agent**: Frontend-Agent
**Estimate**: 30 minutes
**Completed**: 2025-10-02

**Status**: ‚ö†Ô∏è **NEEDS VERIFICATION**

---

### Phase 4: Animation Implementation (2 hours) ‚úÖ COMPLETED

#### TASK-009: Implement "Bild fliegt zur Library" Animation
**Status**: ‚úÖ `completed`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 1.5 hours
**Completed**: 2025-10-02

**Status**: ‚úÖ **COMPLETED** - Animation funktioniert perfekt (600ms, 60fps)

---

#### TASK-010: Add Animation CSS
**Status**: ‚úÖ `completed`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 15 minutes
**Completed**: 2025-10-02

**Status**: ‚úÖ **COMPLETED**

---

#### TASK-011: Write Animation Tests
**Status**: ‚úÖ `completed`
**Priority**: `P1` (High)
**Agent**: Frontend-Agent
**Estimate**: 30 minutes
**Completed**: 2025-10-02

**Status**: ‚úÖ **COMPLETED** - 28/28 tests passing

---

### Phase 5: Backend Integration (1 hour) ‚ö†Ô∏è KORRIGIEREN

#### TASK-012: Update Backend Prompt f√ºr Bildgenerierung ‚ö†Ô∏è ANPASSEN
**Status**: ‚ùå `needs-rework`
**Priority**: `P1` (High)
**Agent**: Backend-Agent
**Estimate**: 45 minutes

**Description**:
Backend Prompt-Engineering f√ºr **BILD-Generierung** (nicht Arbeitsblatt!).

**ALTE Implementation** (FALSCH):
```typescript
const buildPrompt = (formData) => {
  let prompt = `Thema: ${formData.theme}`;
  prompt += `Lerngruppe: ${formData.learningGroup}`;
  if (formData.dazSupport) { ... }
  if (formData.learningDifficulties) { ... }
};
```

**NEUE Implementation** (KORREKT):
```typescript
interface ImageGenerationParams {
  description: string;        // User input
  imageStyle: string;         // "realistic" | "cartoon" | "illustrative" | "abstract"
}

const buildImagePrompt = (params: ImageGenerationParams): string => {
  const stylePrompts = {
    realistic: 'photorealistic, detailed, educational',
    cartoon: 'cartoon style, friendly, colorful',
    illustrative: 'illustrated, clear, pedagogical',
    abstract: 'abstract, conceptual, thought-provoking'
  };

  return `
Create an educational image with the following description:
${params.description}

Style: ${stylePrompts[params.imageStyle]}

Requirements:
- Educational context
- Clear visual elements
- Suitable for classroom use
- High quality
`;
};
```

**Acceptance Criteria**:
- [ ] Backend accepts: `{ description, imageStyle }`
- [ ] Prompt ist optimiert f√ºr DALL-E/Midjourney
- [ ] Style-Varianten funktionieren
- [ ] Backend unit tests passing

**Files to Modify**:
- [ ] `teacher-assistant/backend/src/agents/langGraphImageGenerationAgent.ts`
- [ ] `teacher-assistant/backend/src/routes/langGraphAgents.ts` (Validation bereits gefixt in BUG-002!)

---

### Phase 6: Integration & QA (3 hours)

#### TASK-013: Write Full Workflow Integration Test
**Status**: ‚è≥ `todo`
**Priority**: `P0` (Critical)
**Agent**: Frontend-Agent
**Estimate**: 1 hour

**Description**:
Integration test f√ºr **KORREKTEN** Bildgenerierungs-Workflow.

**Test Flow**:
1. Confirmation Message erscheint
2. User klickt "Ja, Bild erstellen"
3. **Modal √∂ffnet mit Beschreibung + Bildstil**
4. User klickt "Bild generieren"
5. Ladescreen erscheint
6. Preview-Modal √∂ffnet mit Bild
7. User klickt "Weiter im Chat"
8. Animation startet
9. Modal schlie√üt
10. Bild in Library gespeichert

**Files to Create**:
- [ ] `teacher-assistant/frontend/src/components/AgentModal.integration.test.tsx`

---

#### TASK-014: Write Playwright E2E Tests
**Status**: ‚è≥ `todo`
**Priority**: `P0` (Critical)
**Agent**: QA-Agent
**Estimate**: 1.5 hours

**Description**:
E2E Tests f√ºr vollst√§ndigen Workflow.

**Test Scenarios**:
1. ‚úÖ Full workflow (Chat ‚Üí Confirmation ‚Üí Form ‚Üí Ladescreen ‚Üí Preview ‚Üí Animation)
2. ‚úÖ Form validation (empty description ‚Üí disabled button)
3. ‚úÖ "Zur√ºck zum Chat" schlie√üt Modal ohne zu generieren
4. ‚úÖ "Teilen" button functionality
5. ‚úÖ Animation visual verification
6. ‚úÖ Library search findet Bild √ºber Tags

**Files to Create**:
- [ ] `teacher-assistant/frontend/e2e-tests/image-generation-workflow.spec.ts`

---

#### TASK-015: Run Full Test Suite & Documentation
**Status**: ‚è≥ `todo`
**Priority**: `P0` (Critical)
**Agent**: QA-Agent
**Estimate**: 30 minutes

**Description**:
Final QA + Session Log.

**Acceptance Criteria**:
- [ ] All unit tests passing
- [ ] All integration tests passing
- [ ] All E2E tests passing
- [ ] Playwright screenshots zeigen korrekte UI
- [ ] Session log created

**Files to Create**:
- [ ] `docs/development-logs/sessions/2025-10-03/session-02-image-generation-corrected.md`

---

## Task Dependencies Graph

```
TASK-001 (Confirmation) ‚îÄ‚îÄ‚ñ∂ TASK-003 (ChatView Integration) ‚úÖ DONE
                               ‚îÇ
                               ‚ñº
TASK-004 (Type Update) ‚îÄ‚îÄ‚ñ∂ TASK-005 (Form Redesign) ‚ö†Ô∏è NEEDS REWORK
                               ‚îÇ
                               ‚îú‚îÄ‚îÄ‚ñ∂ TASK-006 (Form Tests)
                               ‚îÇ
                               ‚îú‚îÄ‚îÄ‚ñ∂ TASK-016 (Ladescreen) üÜï
                               ‚îÇ
                               ‚îî‚îÄ‚îÄ‚ñ∂ TASK-017 (Preview Modal) üÜï
                                        ‚îÇ
                                        ‚ñº
TASK-009 (Animation) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Works with Preview ‚úÖ DONE
                                        ‚îÇ
                                        ‚ñº
TASK-012 (Backend Prompt) ‚îÄ‚îÄ‚ñ∂ TASK-018 (Auto-Tagging) üÜï
                                        ‚îÇ
                                        ‚ñº
All Tasks ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ TASK-013 (Integration Tests)
                                        ‚îÇ
                                        ‚ñº
                                   TASK-014 (E2E Tests)
                                        ‚îÇ
                                        ‚ñº
                                   TASK-015 (Final QA)
```

---

## Progress Tracking

### Checklist

**Phase 1: Confirmation (2h)** ‚úÖ COMPLETED
- [x] TASK-001: AgentConfirmationMessage ‚úÖ
- [x] TASK-002: Unit Tests ‚úÖ
- [x] TASK-003: ChatView Integration ‚úÖ

**Phase 2: Bild-Form (3h)** ‚ùå NEEDS REWORK
- [ ] TASK-004: Type Definition (description + imageStyle) ‚ö†Ô∏è
- [ ] TASK-005: Form Redesign (2 Felder, 2 Buttons) ‚ö†Ô∏è
- [ ] TASK-006: Form Tests ‚ö†Ô∏è

**Phase 2.5: Ladescreen & Preview (2.5h)** üÜï NEW
- [ ] TASK-016: Ladescreen ‚è≥
- [ ] TASK-017: Preview Modal ‚è≥
- [ ] TASK-018: Auto-Tagging ‚è≥

**Phase 3: Result Enhancement (2h)** ‚ö†Ô∏è VERIFY
- [x] TASK-007: Buttons (verify Preview integration) ‚ö†Ô∏è
- [x] TASK-008: Button Tests ‚ö†Ô∏è

**Phase 4: Animation (2h)** ‚úÖ COMPLETED
- [x] TASK-009: Animation ‚úÖ
- [x] TASK-010: CSS ‚úÖ
- [x] TASK-011: Animation Tests ‚úÖ

**Phase 5: Backend (1h)** ‚ö†Ô∏è NEEDS REWORK
- [ ] TASK-012: Prompt Engineering (description + imageStyle) ‚ö†Ô∏è

**Phase 6: QA (3h)** ‚è≥ PENDING
- [ ] TASK-013: Integration Tests ‚è≥
- [ ] TASK-014: E2E Tests ‚è≥
- [ ] TASK-015: Final QA & Docs ‚è≥

---

## Critical Path

**MUST DO NEXT** (in order):
1. **TASK-004**: Fix Type Definition (15 min)
2. **TASK-005**: Rewrite AgentFormView (2 hours)
3. **TASK-012**: Fix Backend Prompt (45 min)
4. **TASK-016**: Add Ladescreen (1 hour)
5. **TASK-017**: Add Preview Modal (1.5 hours)
6. **TASK-018**: Implement Auto-Tagging (2 hours)
7. **TASK-014**: E2E Tests (1.5 hours)
8. **TASK-015**: Final QA (30 min)

**Total Remaining**: ~9.5 hours

---

## Status Summary

**Completed**: 8/18 tasks (44%)
**Needs Rework**: 3 tasks (TASK-004, TASK-005, TASK-012)
**New Tasks**: 3 tasks (TASK-016, TASK-017, TASK-018)
**Remaining**: 10 tasks

**Deployment Status**: ‚ùå **NOT READY** - Form implementation is incorrect

---

**Last Updated**: 2025-10-03
**Maintained By**: General-Purpose Agent
**Status**: ‚ö†Ô∏è **IN PROGRESS** - Requirements korrigiert, Implementation pending
