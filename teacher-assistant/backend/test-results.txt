
> teacher-assistant-backend@1.0.0 test
> jest

2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mLogger initialized[32m[39m{
  "transports": [
    "Console",
    "ExceptionStream",
    "RejectionStream"
  ]
}
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [quota_exceeded] on attempt 1[31m[39m{
  "error": "Quota exceeded"
}
Error: Quota exceeded
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:130:26)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - quota_exceeded[32m[39m
2025-10-21 07:31:16 [[33m[33mwarn[33m[39m]: [33m[33mError escalated after 1 attempts: quota_exceeded[33m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [invalid_input] on attempt 1[31m[39m{
  "error": "Invalid input provided"
}
Error: Invalid input provided
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:147:26)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - invalid_input[32m[39m
2025-10-21 07:31:16 [[33m[33mwarn[33m[39m]: [33m[33mError escalated after 1 attempts: invalid_input[33m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [network_error] on attempt 4[31m[39m{
  "error": "Network error"
}
Error: Network error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:164:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - network_error[32m[39m
2025-10-21 07:31:16 [[33m[33mwarn[33m[39m]: [33m[33mError escalated after 4 attempts: network_error[33m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [unknown] on attempt 2[31m[39m{
  "error": "Unknown error"
}
Error: Unknown error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:182:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - unknown[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mFailed to check rate limit[31m[39m{
  "error": "Redis connection failed"
}
Error: Redis connection failed
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:238:9)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mFailed to get error statistics[31m[39m{
  "error": "Redis connection failed"
}
Error: Redis connection failed
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:274:9)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [network_error] on attempt 1[31m[39m{
  "error": "Network error"
}
Error: Network error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:315:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - network_error[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [unknown] on attempt 1[31m[39m{
  "error": "Test error for context storage"
}
Error: Test error for context storage
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:336:25)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - unknown[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [network_error] on attempt 2[31m[39m{
  "error": "Network error"
}
Error: Network error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:362:25)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - network_error[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [unknown] on attempt 1[31m[39m{
  "error": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
}
Error: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:399:25)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - unknown[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [unknown] on attempt 1[31m[39m{
  "error": "Test error"
}
Error: Test error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:414:25)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context:  - unknown[32m[39m
PASS src/tests/errorHandlingService.test.ts (25.266 s)
  Error Handling Service
    Error Classification
      √ should classify rate limit errors correctly (64 ms)
      √ should classify quota exceeded errors correctly (2 ms)
      √ should classify API key errors correctly (1 ms)
      √ should classify network errors correctly (1 ms)
      √ should classify timeout errors correctly (1 ms)
      √ should classify validation errors correctly (1 ms)
      √ should classify unknown errors as UNKNOWN (1 ms)
    Error Recovery Strategies
      √ should not retry for quota exceeded errors (246 ms)
      √ should not retry for user input errors (5 ms)
      √ should escalate after maximum retry attempts (5 ms)
      √ should provide fallback for retryable errors within limits (20 ms)
      ○ skipped should provide retry strategy for rate limit errors
    Rate Limiting
      √ should check rate limiting correctly (2 ms)
      √ should increment error count for rate limiting (18 ms)
      √ should handle rate limiting check failures gracefully (3 ms)
    Error Statistics
      √ should get error statistics for different time ranges (10 ms)
      √ should handle statistics retrieval failures gracefully (3 ms)
    German Error Messages
      √ should provide appropriate retry messages with delay information (4 ms)
      ○ skipped should provide German error messages for different error types
    Recovery Context Storage
      √ should store error context for analysis (6 ms)
      √ should track retry attempts (3 ms)
    Edge Cases and Error Handling
      √ should handle very long error messages appropriately (3 ms)
      √ should handle empty operation IDs gracefully (3 ms)
      ○ skipped should handle malformed error objects gracefully

2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "401 {\"error\":{\"message\":\"Invalid API key\"}}",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Test message"
      }
    ]
  }
}
Error: 401 {"error":{"message":"Invalid API key"}}
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:152:24)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "429 {\"error\":{\"message\":\"Rate limit exceeded\"}}",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Test message"
      }
    ]
  }
}
Error: 429 {"error":{"message":"Rate limit exceeded"}}
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:178:24)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "Network error",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Test message"
      }
    ]
  }
}
Error: Network error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:204:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "Generic error",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Test message"
      }
    ]
  }
}
Error: Generic error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:230:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "500 {\"error\":{\"message\":\"Test error\"}}",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Say \"Hello\" to test the service."
      }
    ],
    "model": "gpt-4o-mini",
    "max_tokens": 10,
    "temperature": 0
  }
}
Error: 500 {"error":{"message":"Test error"}}
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:274:24)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
PASS src/services/chatService.test.ts
  ChatService
    createChatCompletion
      √ should return successful response with valid OpenAI response (16 ms)
      √ should handle empty choices response (4 ms)
      √ should handle empty message content (2 ms)
      √ should handle OpenAI API 401 error (invalid API key) (69 ms)
      √ should handle OpenAI API 429 error (rate limit) (20 ms)
      √ should handle network errors (6 ms)
      √ should handle generic errors (4 ms)
      ○ skipped should add system message if not present
    testService
      √ should return true when service test succeeds (1 ms)
      √ should return false when service test fails (4 ms)

2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 24,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 35,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "edit_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 0
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 32,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 31,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
PASS src/routes/__tests__/agentsSdk.test.ts
  POST /api/agents-sdk/test
    TEST-015: Endpoint Returns Test Agent Response
      ○ skipped Endpoint returns test agent response
      ○ skipped Endpoint includes timestamp in response
      ○ skipped Endpoint returns correct content-type
      ○ skipped Endpoint includes SDK version
    TEST-016: Input Validation
      ○ skipped Rejects malformed JSON
      ○ skipped Validates Content-Type header
      ○ skipped Accepts valid empty JSON object
      ○ skipped Accepts JSON with optional parameters
    TEST-017: Error Handling
      ○ skipped Returns 500 on internal error
      ○ skipped Error response follows consistent format
      ○ skipped Error response includes timestamp
    TEST-018: Route Registration
      ○ skipped Route exists at correct path
      ○ skipped Route uses /api/agents-sdk prefix
  GET /api/agents-sdk/health
    Health Check Endpoint
      √ Health endpoint returns SDK status (156 ms)
      √ Health endpoint returns correct SDK version (34 ms)
      √ Health endpoint includes timestamp (18 ms)
      √ Health endpoint returns JSON (33 ms)

2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 0
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": true
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 1,
  "overridden": true,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 15,
  "hasOverride": true
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "edit_image",
  "confidence": 1,
  "overridden": true,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 15,
  "hasOverride": true
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "unknown",
  "confidence": 1,
  "overridden": true,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 11,
  "hasOverride": false
}
2025-10-21 07:31:21 [[31m[31merror[31m[39m]: [31m[31mPOST /api/agents-sdk/router/classify - Agent execution failed[31m[39m{
  "error": "Test error"
}
Error: Test error
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\agentsSdk.ts:224:11
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 15,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 0
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 15,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 24,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 2
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[31m[31merror[31m[39m]: [31m[31mFailed to cleanup Redis test data[31m[39m{
  "error": "Reached the max retries per request limit (which is 1). Refer to \"maxRetriesPerRequest\" option for details."
}
MaxRetriesPerRequestError: Reached the max retries per request limit (which is 1). Refer to "maxRetriesPerRequest" option for details.
    at Socket.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\ioredis\built\redis\event_handler.js:182:37)
    at Object.onceWrapper (node:events:633:26)
    at Socket.emit (node:events:518:28)
    at TCP.<anonymous> (node:net:351:12)
PASS src/tests/redis.integration.test.ts
  Redis Integration Tests
    Redis Connection
      √ should connect to Redis successfully (75 ms)
      √ should handle connection failures gracefully (1046 ms)
      √ should provide health check information (24 ms)
    Checkpoint Storage and Retrieval
      √ should store checkpoint data successfully (7 ms)
      √ should retrieve checkpoint data successfully (11 ms)
      √ should handle checkpoint updates correctly (6 ms)
      √ should handle checkpoint expiration correctly (11 ms)
    State Persistence and Recovery
      √ should persist execution state across connection restarts (20 ms)
      √ should handle failed state recovery gracefully (13 ms)
      √ should handle corrupted checkpoint data (5 ms)
    Performance and Concurrency
      √ should handle multiple concurrent checkpoint operations (10 ms)
      √ should measure checkpoint storage performance (28 ms)
    Memory and Resource Management
      √ should handle memory usage efficiently (12 ms)
      √ should handle Redis resource limits gracefully (14 ms)
    Error Scenarios and Recovery
      √ should handle network interruptions (4 ms)
      √ should provide meaningful error messages (1024 ms)

2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 0
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 3,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 1998,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
PASS src/routes/__tests__/routerEndpoint.test.ts
  Router Endpoint Integration Tests
    POST /api/agents-sdk/router/classify
      √ should classify create_image intent successfully (350 ms)
      √ should classify edit_image intent successfully (28 ms)
      √ should handle German prompts (19 ms)
      √ should return entities in response (28 ms)
      √ should include reasoning in response (20 ms)
      √ should provide confidence score (18 ms)
    Manual Override Functionality
      √ should accept manual override to create_image (18 ms)
      √ should accept manual override to edit_image (16 ms)
      √ should accept manual override to unknown (36 ms)
      √ should reject invalid override value (39 ms)
    Request Validation
      √ should reject missing prompt (13 ms)
      √ should reject empty prompt (19 ms)
      √ should reject whitespace-only prompt (26 ms)
      √ should reject prompt that is too short (20 ms)
      √ should reject prompt that is too long (15 ms)
      √ should reject non-string prompt (14 ms)
      √ should reject invalid JSON body (38 ms)
    Error Handling
      √ should return German error messages (12 ms)
      √ should include timestamp in error response (23 ms)
      √ should handle agent execution failure gracefully (38 ms)
    Response Format
      √ should return standardized success response format (42 ms)
      √ should return standardized error response format (14 ms)
      √ should have correct content-type header (22 ms)
    Performance
      √ should respond within reasonable time (12 ms)
      √ should handle multiple concurrent requests (96 ms)
    Edge Cases
      √ should handle prompt with special characters (22 ms)
      √ should handle prompt with unicode characters (36 ms)
      √ should handle prompt with line breaks (19 ms)
      √ should handle very short valid prompt (20 ms)
      √ should handle maximum length prompt (13 ms)

PASS src/routes/__tests__/agentsSdkImageGeneration.test.ts
  POST /api/agents-sdk/image/generate
    Successful Requests
      √ should generate image with minimal parameters (576 ms)
      √ should accept all size parameters (77 ms)
      √ should accept all quality parameters (37 ms)
      √ should accept all style parameters (36 ms)
      √ should accept educational context parameters (32 ms)
      √ should accept Gemini form input with description (27 ms)
      √ should accept all imageStyle values (98 ms)
      √ should handle enhancePrompt flag (21 ms)
      √ should use prompt when both prompt and description provided (20 ms)
    Validation Errors (400)
      √ should reject request with no prompt and no description (26 ms)
      √ should reject prompt shorter than 3 characters (20 ms)
      √ should reject prompt longer than 1000 characters (20 ms)
      √ should reject invalid size (20 ms)
      √ should reject invalid quality (18 ms)
      √ should reject invalid style (22 ms)
      √ should reject invalid imageStyle (37 ms)
      √ should reject non-string prompt (36 ms)
      √ should trim whitespace and validate (18 ms)
    Agent Execution Errors (500)
      √ should return 500 if agent execution fails (18 ms)
      √ should return 500 if agent throws exception (13 ms)
      √ should handle OpenAI rate limit errors (52 ms)
      √ should handle quota exceeded errors (22 ms)
      √ should handle content policy violations (12 ms)
    Response Format
      √ should return complete response structure (37 ms)
      √ should include timestamp in all responses (48 ms)
      √ should include timestamp in error responses (22 ms)
    Request Logging
      √ should log request details (26 ms)
      √ should pass userId from request context if available (14 ms)
    Edge Cases
      √ should handle empty optional fields (22 ms)
      √ should handle special characters in prompt (25 ms)
      √ should handle German umlauts in prompt (14 ms)
      √ should handle very long valid prompts (15 ms)
      √ should handle mixed Gemini and legacy parameters (14 ms)
    Test Mode Support
      √ should work in test mode (17 ms)

PASS src/services/summaryService.test.ts
  SummaryService
    generateSummary
      √ should generate a summary ≤20 characters (5 ms)
      √ should enforce 20-character limit on long summaries (2 ms)
      √ should return fallback text on OpenAI API error (3 ms)
      √ should return "Neuer Chat" for empty messages array (2 ms)
      √ should use only first 4 messages for context (14 ms)
      √ should call OpenAI with correct parameters (1 ms)
    generateSummaryWithRetry
      √ should return summary on first attempt success (2 ms)
      √ should retry on first attempt failure and succeed on second attempt (519 ms)
      √ should return fallback text after both attempts fail (517 ms)
    validateSummaryLength
      √ should return true for valid summaries (1 ms)
      √ should return false for invalid summaries (1 ms)
    buildPrompt (via integration)
      √ should format messages correctly in prompt (1 ms)

PASS src/routes/chat-summary.test.ts
  Chat Summary API Routes
    POST /chat/summary
      √ should generate and store a summary successfully (219 ms)
      √ should return 400 if chatId is missing (15 ms)
      √ should return 400 if messages is missing (20 ms)
      √ should return 400 if messages is not an array (58 ms)
      √ should return 400 if messages array is empty (24 ms)
      √ should return 400 if message has invalid structure (14 ms)
      √ should return 400 if message has invalid role (20 ms)
      √ should limit messages to first 4 for summary generation (14 ms)
      √ should return 500 if summary generation throws an error (16 ms)
      √ should still return summary even if database update fails (55 ms)
      √ should handle summary with special characters (18 ms)
    GET /chat/:chatId/summary
      √ should return placeholder response (endpoint implementation pending) (21 ms)
      √ should handle missing chatId parameter (15 ms)
    Integration Flow
      √ should handle complete flow: validate -> generate -> store -> respond (13 ms)

PASS src/routes/chatTags.test.ts
  Chat Tags API Routes
    POST /api/chat/:chatId/tags
      √ should extract and save tags for a chat session (205 ms)
      √ should return 400 when chat ID is missing (20 ms)
      √ should return 503 when InstantDB is unavailable (42 ms)
      √ should return 404 when chat session is not found (45 ms)
      √ should return 400 when chat has no messages (17 ms)
      √ should return success with empty tags when no tags extracted (62 ms)
      √ should return 500 when tag saving fails (19 ms)
    PUT /api/chat/:chatId/tags
      √ should manually update tags (33 ms)
      √ should return 400 when tags are not an array (30 ms)
      √ should return 400 when tag structure is invalid (28 ms)
      √ should limit tags to 5 (13 ms)
    DELETE /api/chat/:chatId/tags
      √ should remove tags from chat session (29 ms)
      √ should return 503 when InstantDB is unavailable (17 ms)
      √ should return 500 when deletion fails (46 ms)
    GET /api/chat/:chatId/tags
      √ should retrieve tags for chat session (24 ms)
      √ should return 503 when InstantDB is unavailable (15 ms)

PASS src/routes/materials.test.ts
  Materials Management Routes
    POST /api/materials/update-title
      Manual artifacts
        √ should successfully update a manual artifact title (79 ms)
        √ should return 404 if manual artifact not found (39 ms)
      Generated artifacts
        √ should successfully update a generated artifact title (28 ms)
        √ should return 404 if generated artifact not found (14 ms)
      Upload title change rejection
        √ should reject title change for uploads (13 ms)
      Validation
        √ should reject request with missing materialId (22 ms)
        √ should reject request with missing newTitle (35 ms)
        √ should reject request with missing source (16 ms)
        √ should reject request with empty title (13 ms)
        √ should reject request with invalid source type (15 ms)
      Database availability
        √ should return 503 if InstantDB is not available (13 ms)
      Error handling
        √ should handle database errors gracefully (21 ms)
    DELETE /api/materials/:id
      Manual artifacts
        √ should successfully delete a manual artifact (15 ms)
        √ should return 404 if manual artifact not found (30 ms)
      Generated artifacts
        √ should successfully delete a generated artifact (12 ms)
        √ should return 404 if generated artifact not found (40 ms)
      Upload deletion rejection
        √ should reject deletion for uploads (20 ms)
      Validation
        √ should reject request with missing source parameter (14 ms)
        √ should reject request with invalid source type (18 ms)
      Database availability
        √ should return 503 if InstantDB is not available (39 ms)
      Error handling
        √ should handle database errors gracefully (18 ms)
    Integration Tests
      √ should support complete workflow: update title then delete (44 ms)
      √ should handle mixed material types independently (26 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
PASS src/routes/profile.test.ts
  POST /profile/extract
    √ should extract characteristics with valid request (30 ms)
    √ should return 400 with missing userId (16 ms)
    √ should return 400 with missing messages (38 ms)
    √ should return 400 with insufficient messages (< 2) (53 ms)
    √ should return 500 on service error (12 ms)
  GET /profile/characteristics
    √ should return filtered characteristics (count >= 3) (19 ms)
    √ should return 400 with missing userId (12 ms)
    √ should return 500 on service error (13 ms)
  POST /profile/characteristics/add
    √ should add manual characteristic successfully (15 ms)
    √ should trim whitespace from characteristic (12 ms)
    √ should return 400 with missing userId (16 ms)
    √ should return 400 with missing characteristic (12 ms)
    √ should return 400 with empty characteristic (17 ms)
    √ should return 500 on service error (11 ms)
  POST /profile/characteristics/categorize
    √ should categorize uncategorized characteristics (12 ms)
    √ should return 400 with missing userId (9 ms)
    √ should return 503 when InstantDB not available (10 ms)
    √ should handle partial failures gracefully (11 ms)
    √ should return 500 on service error (11 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 24,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 32,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 2
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 35,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 35,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "unknown",
  "confidence": 0.3,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 31,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 41,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 35,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 13,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 83,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 24,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 17,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "unknown",
  "confidence": 0.3,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 14,
  "hasOverride": true
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent using manual override[32m[39m{
  "overrideIntent": "create_image"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 15,
  "hasOverride": true
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent using manual override[32m[39m{
  "overrideIntent": "edit_image"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 15,
  "hasOverride": true
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent using manual override[32m[39m{
  "overrideIntent": "unknown"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 28,
  "hasOverride": true
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent using manual override[32m[39m{
  "overrideIntent": "create_image"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 0,
  "hasOverride": false
}
2025-10-21 07:31:24 [[31m[31merror[31m[39m]: [31m[31mRouterAgent execution failed[31m[39m{
  "error": "Prompt cannot be empty"
}
Error: Prompt cannot be empty
    at RouterAgent.execute (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\routerAgent.ts:108:15)
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\__tests__\routerAgent.test.ts:303:40)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 3,
  "hasOverride": false
}
2025-10-21 07:31:24 [[31m[31merror[31m[39m]: [31m[31mRouterAgent execution failed[31m[39m{
  "error": "Prompt cannot be empty"
}
Error: Prompt cannot be empty
    at RouterAgent.execute (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\routerAgent.ts:108:15)
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\__tests__\routerAgent.test.ts:315:40)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 0,
  "hasOverride": false
}
2025-10-21 07:31:24 [[31m[31merror[31m[39m]: [31m[31mRouterAgent execution failed[31m[39m{
  "error": "Prompt cannot be empty"
}
Error: Prompt cannot be empty
    at RouterAgent.execute (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\routerAgent.ts:108:15)
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\__tests__\routerAgent.test.ts:326:40)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 619,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 3
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 30,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 41,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 49,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 55,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.92,
  "executionTimeMs": 1
}
PASS src/services/profileExtractionService.test.ts
  ProfileExtractionService
    extractCharacteristics
      √ should extract 2-3 characteristics from valid chat (25 ms)
      √ should handle empty/short chats gracefully (1 ms)
      √ should limit extraction to max 3 characteristics (1 ms)
      √ should handle OpenAI API failure gracefully (1 ms)
      √ should handle invalid JSON response from OpenAI (1 ms)
      √ should avoid duplicate characteristics (1 ms)
    categorizeCharacteristic
      √ should categorize subjects correctly
      √ should categorize grade levels correctly (1 ms)
      √ should categorize teaching styles correctly (1 ms)
      √ should categorize school types correctly (1 ms)
      √ should categorize topics correctly
      √ should default to uncategorized for invalid category (1 ms)
      √ should default to uncategorized on OpenAI error (1 ms)
      √ should return uncategorized for case mismatch (1 ms)
    buildExtractionPrompt
      √ should build prompt with conversation and existing profile (2 ms)
      √ should handle empty existing profile (1 ms)
      √ should limit conversation to last 10 messages (1 ms)
    error handling and edge cases
      √ should handle missing userId (1 ms)
      √ should handle null messages array (1 ms)
      √ should continue processing even if one characteristic fails to increment (1 ms)

PASS src/agents/__tests__/routerAgent.test.ts
  RouterAgent Unit Tests
    Initialization
      √ should initialize with correct properties (14 ms)
      √ should have correct default confidence threshold (2 ms)
    Intent Classification
      √ should classify create_image intent from English prompt (9 ms)
      √ should classify create_image intent from German prompt (4 ms)
      √ should classify edit_image intent from English prompt (27 ms)
      √ should classify edit_image intent from German prompt (7 ms)
      √ should return unknown for ambiguous prompts (2 ms)
      √ should provide reasoning for classification (3 ms)
    Entity Extraction
      √ should extract subject from prompt (3 ms)
      √ should extract grade level from prompt (3 ms)
      √ should extract German grade level (3 ms)
      √ should extract topic from prompt (2 ms)
      √ should extract style from prompt (3 ms)
      √ should handle prompts without entities (2 ms)
      √ should extract multiple entities from complex prompt (3 ms)
    Confidence Scores
      √ should provide confidence score between 0 and 1 (3 ms)
      √ should have high confidence for clear prompts (3 ms)
      √ should have lower confidence for ambiguous prompts (1 ms)
    Manual Override
      √ should respect manual override to create_image (3 ms)
      √ should respect manual override to edit_image (4 ms)
      √ should respect manual override to unknown (3 ms)
      √ should still extract entities with override (3 ms)
    Error Handling
      √ should reject empty prompt (67 ms)
      √ should reject whitespace-only prompt (3 ms)
      √ should format error messages in German (3 ms)
    Parameter Validation
      √ should validate valid parameters (2 ms)
      √ should validate parameters with override (1 ms)
      √ should reject empty prompt in validation (1 ms)
      √ should reject non-string prompt (2 ms)
      √ should reject invalid override value (7 ms)
    Execution Time Estimation
      √ should provide reasonable execution time estimate (2 ms)
    Edge Cases
      √ should handle very long prompts (2 ms)
      √ should handle prompts with special characters (5 ms)
      √ should handle multilingual prompts (2 ms)
      √ should handle prompts with numbers and dates (2 ms)
    Multiple Keywords
      √ should handle prompts with both create and edit keywords (2 ms)
      √ should prioritize stronger keywords (1 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 4
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 2
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 63,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.875,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 25
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 53,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 61,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 56,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 49,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.75,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 54,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8450000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 5
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 49,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.92,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 58,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 55,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.935,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 70,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 37,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 47,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 27,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 25,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 61,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 41,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 47,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.875,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 59,
  "hasOverride": false
}
PASS src/agents/langGraphImageGenerationAgent.test.ts
  LangGraphImageGenerationAgent - buildPrompt
    buildPrompt()
      ○ skipped should create basic prompt without DaZ or learning difficulties
      ○ skipped should include DaZ considerations when enabled
      ○ skipped should include learning difficulties considerations when enabled
      ○ skipped should include both DaZ and learning difficulties when both enabled
      ○ skipped should always include style guidelines
      ○ skipped should handle special characters in description correctly
      ○ skipped should handle different learning groups correctly
    execute() - Gemini Integration
      ○ skipped should detect Gemini input and use buildPrompt
      ○ skipped should use old enhancement method when Gemini params not present
    Prompt Output Validation
      ○ skipped should produce prompt with correct structure
      ○ skipped should produce prompt that is not too long for DALL-E
  LangGraphImageGenerationAgent - Auto-Tagging (TASK-018)
    generateTitleAndTags
      √ should generate title and tags using ChatGPT (28 ms)
      √ should limit tags to 5 maximum (8 ms)
      √ should use fallback if ChatGPT fails (84 ms)
      √ should extract educational keywords in fallback (5 ms)
      ○ skipped should work with Gemini form input
    Artifact creation with tags
      √ should include tags in artifact_data (2 ms)
      √ should include tags in metadata for searchability (2 ms)
    Title generation
      √ should generate concise German titles (2 ms)
    Error handling
      √ should handle invalid JSON response from ChatGPT (4 ms)
      √ should handle empty ChatGPT response (3 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 41,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 54,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 67,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 49,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.92,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 51,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.7,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 54,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8450000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 53,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 47,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 47,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 58,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 54,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 59,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 66,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.92,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 51,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 56,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 38,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 53,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.7,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 63,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.875,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 63,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 2
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 10
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.875,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 2
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 63,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
PASS src/tests/langGraphAgentService.test.ts (7.358 s)
  LangGraph Agent Service
    Service Initialization
      ○ skipped should initialize LangGraph service successfully
      ○ skipped should register LangGraph agents
    Agent Workflow Execution
      ○ skipped should execute image generation agent with workflow
      ○ skipped should handle validation errors properly
      ○ skipped should handle non-existent agent gracefully
      ○ skipped should support different progress levels
    Error Handling and Recovery
      ○ skipped should handle OpenAI API errors with recovery
      ○ skipped should preserve credits on failure
    Execution Status Tracking
      ○ skipped should track execution status
      ○ skipped should support execution cancellation
    Agent Parameter Validation
      ○ skipped should validate image generation parameters correctly
      ○ skipped should estimate costs correctly
    Educational Enhancement Features
      ○ skipped should enhance German prompts for educational context
      ○ skipped should handle English prompts without unnecessary enhancement
    Progress Streaming Integration
      ○ skipped should create progress tracker for executions
      ○ skipped should handle different progress levels correctly
  LangGraph Image Generation Agent
    √ should create workflow successfully (12 ms)
    √ should have correct workflow configuration (3 ms)
    √ should have all required agent properties (3 ms)
    √ should support educational context parameters (1 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.875,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
PASS src/agents/__tests__/routerAccuracy.test.ts
  Router Agent Accuracy Tests
    √ should achieve ≥95% accuracy on 100-sample test dataset (119 ms)
    √ should correctly classify create_image intents (8 ms)
    √ should correctly classify edit_image intents (6 ms)
    √ should handle German prompts with high accuracy (22 ms)
    √ should handle English prompts with high accuracy (9 ms)
    √ should provide confidence scores ≥0.7 for correct classifications (14 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "einem Vulkan"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Ich brauche ein Bild für meine 7. Klasse zum Thema Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "den Wasserkreislauf für mich"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese für Klasse 7a"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Bild für 9. Klasse zum Thema Zellaufbau"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "m Thema Bruchrechnung"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "m Thema \"Der Wasserkreislauf in der Natur\""
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Klasse 7 zur Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "7. Klasse zum Thema Zellaufbau"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Klasse 7a"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Jahrgangsstufe 9 zum Thema Französische Revolution"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Bruchrechnung"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Klasse 7 zur Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "R PHOTOSYNTHESE"
}
PASS src/config/index.test.ts
  Configuration
    config object
      √ should have all required properties (2 ms)
      √ should have correct PORT type (1 ms)
      √ should have correct NODE_ENV (1 ms)
      √ should have valid FRONTEND_URL (2 ms)
      √ should have API_PREFIX (3 ms)
    environment helpers
      √ should correctly identify test environment (1 ms)
      √ should be boolean values (1 ms)
      √ should have only one environment flag as true

PASS src/services/agentIntentService.test.ts
  AgentIntentService
    detectAgentIntent
      Image Generation Intent
        √ should detect "erstelle ein bild" intent (18 ms)
        √ should detect "generiere bild" intent (4 ms)
        √ should detect "bild für" intent (2 ms)
        √ should detect "visualisiere" intent (2 ms)
        √ should extract learning group from message (1 ms)
        √ should extract learning group from alternative pattern (2 ms)
        √ should use context subject if available (2 ms)
        √ should use context grade as fallback (1 ms)
      Worksheet Intent
        ○ skipped should detect "arbeitsblatt" intent
        ○ skipped should detect "übungen" intent
        ○ skipped should detect "aufgaben" intent
      Lesson Plan Intent
        ○ skipped should detect "unterrichtsplan" intent
        ○ skipped should detect "stundenentwurf" intent
        ○ skipped should detect "unterricht planen" intent
      No Intent Detection
        √ should return null for regular questions (1 ms)
        √ should return null for general teaching questions
        √ should return null for chat messages (1 ms)
      Theme Extraction
        √ should clean trigger words from theme (2 ms)
        √ should extract description after "zum Thema" (1 ms)
        √ should handle complex themes (1 ms)
        √ should remove trailing punctuation and politeness (1 ms)
      Learning Group Extraction
        √ should extract "Klasse 7" (1 ms)
        √ should extract "7. Klasse" (1 ms)
        √ should extract "Klasse 7a" with letter suffix (1 ms)
        √ should extract "Jahrgangsstufe 9" (2 ms)
      Context Integration
        √ should use teacher context for subject (2 ms)
        √ should prioritize message grade over context (1 ms)
        √ should fallback to context grade if not in message (2 ms)
      Edge Cases
        √ should handle empty message
        √ should handle very short message
        √ should handle message with only trigger word (1 ms)
        √ should handle uppercase message (2 ms)
        ○ skipped should handle mixed case with umlauts

PASS src/tests/agents.test.ts (33.315 s)
  Agent System Tests
    Agent Registry
      ○ skipped should register and retrieve agents
      ○ skipped should get all enabled agents
      ○ skipped should find agents by trigger keywords
    Image Generation Agent
      ○ skipped should validate correct parameters
      ○ skipped should reject invalid parameters
      ○ skipped should estimate costs correctly
      ○ skipped should detect German text correctly
      ○ skipped should generate appropriate image titles
    API Endpoints
      GET /api/agents/available
        ○ skipped should return available agents
      POST /api/agents/execute
        ○ skipped should validate required fields
        ○ skipped should reject non-existent agent
      POST /api/agents/image/generate
        ○ skipped should validate image generation parameters
        ○ skipped should accept valid image generation parameters
      GET /api/agents/image/usage/:userId
        ○ skipped should return usage information for valid user
        ○ skipped should validate user ID parameter
      GET /api/agents/artifacts/:userId
        ○ skipped should return artifacts for valid user
        ○ skipped should handle query parameters
        ○ skipped should validate limit parameter
      GET /api/agents/triggers
        ○ skipped should find agents by trigger text
        ○ skipped should require text parameter
        ○ skipped should handle text that matches no agents
      POST /api/agents/artifacts/:artifactId/favorite
        ○ skipped should validate required fields
        ○ skipped should accept valid favorite toggle request
    Agent Execution Service
      ○ skipped should handle agent execution with invalid agent ID
      ○ skipped should handle agent execution with invalid parameters
    Security and Validation
      ○ skipped should apply rate limiting
      ○ skipped should filter inappropriate content
  Agent Error Handling
    √ should handle database connection errors gracefully (45 ms)
    √ should handle OpenAI API errors gracefully
  Performance Tests
    √ should handle concurrent agent execution requests (1 ms)
    √ should complete image generation within reasonable time (1 ms)

PASS src/services/profileDeduplicationService.test.ts
  profileDeduplicationService
    findSimilarCharacteristics
      √ should find exact matches with different casing (3 ms)
      √ should find abbreviation matches (2 ms)
      √ should find typo matches (2 ms)
      √ should prefer longer names over abbreviations (1 ms)
      √ should handle multiple similar characteristics in one group (1 ms)
      √ should not group dissimilar characteristics (1 ms)
      √ should throw error when InstantDB is not available (65 ms)
    mergeSimilarCharacteristics
      √ should merge characteristics correctly (4 ms)
      √ should throw error if keep characteristic not found (2 ms)
      √ should throw error if merge characteristics not found (2 ms)
      √ should throw error when InstantDB is not available (3 ms)
    findSimilarExisting
      √ should find exact match (1 ms)
      √ should find abbreviation match (1 ms)
      √ should find similarity match (1 ms)
      √ should return null if no similar characteristic found (1 ms)
      √ should return null when InstantDB is not available (1 ms)
      √ should handle errors gracefully (1 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mProcessing file with filename[32m[39m{
  "original": "test.txt",
  "hasUmlauts": false,
  "byteLength": 8,
  "charLength": 8
}
PASS src/routes/health.test.ts (7.6 s)
  Health Routes
    GET /api/health
      √ should return health check data (81 ms)
      √ should return correct health data structure (18 ms)
      √ should return valid timestamp format (18 ms)
      √ should return environment as test (13 ms)
      √ should return uptime as a number (22 ms)
      √ should return version as string (22 ms)
      √ should have correct content type (12 ms)
      √ should be fast response (11 ms)

PASS src/app.test.ts (7.944 s)
  Express App
    GET /
      √ should return welcome message (115 ms)
      √ should return valid timestamp format (18 ms)
    API Endpoints
      √ should handle API routes (18 ms)
    404 Handler
      √ should return 404 for non-existent routes (10 ms)
      √ should return 404 with timestamp (24 ms)
    CORS Configuration
      √ should include CORS headers (25 ms)
      √ should handle preflight OPTIONS requests (9 ms)
    JSON Body Parsing
      √ should parse JSON bodies (12 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mFile validation successful[32m[39m{
  "filename": "test.txt",
  "hasUmlauts": false,
  "byteLength": 8,
  "charLength": 8
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mProcessing file upload: test.txt (20 bytes)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mUploading file to OpenAI with German umlaut support[32m[39m{
  "originalFilename": "test.txt",
  "normalizedFilename": "test.txt",
  "hasUmlauts": false,
  "fileSize": 20,
  "byteLength": 8
}
PASS src/services/chatTagService.test.ts
  ChatTagService
    extractChatTags
      √ should extract tags from chat messages (6 ms)
      √ should return empty array for empty messages (2 ms)
      √ should handle OpenAI API errors gracefully (1 ms)
      √ should handle invalid JSON responses (1 ms)
      √ should filter out invalid tags (1 ms)
      √ should limit tags to 5 (1 ms)
      √ should analyze only first 10 messages (1 ms)
    extractTagsFromText
      √ should extract tags from text (2 ms)
      √ should return empty array for empty text (2 ms)
    mergeTags
      √ should merge and deduplicate tags (2 ms)
      √ should limit merged tags to 5
    tagsToStringArray
      √ should convert tags to string array (1 ms)
    stringArrayToTags
      √ should convert string array to tags (1 ms)

PASS src/routes/langGraphAgents.test.ts
  LangGraph Agent Validation
    Gemini Form Format
      √ should accept valid Gemini form data (10 ms)
      √ should reject Gemini form with missing theme (2 ms)
      √ should reject Gemini form with short theme (4 ms)
      √ should accept Gemini form with optional fields defaulted (1 ms)
    Legacy Params Format
      √ should accept valid legacy params (1 ms)
      √ should reject legacy params with invalid size (1 ms)
      √ should reject legacy params without prompt
    Simple String Input
      √ should accept string input (1 ms)
      √ should accept input in legacy params format (1 ms)
    Edge Cases
      √ should reject request without agentId (1 ms)
      √ should accept request without userId (optional) (1 ms)
      √ should default progressLevel to user_friendly (1 ms)
      √ should default confirmExecution to false
    Multiple Input Formats (Union)
      √ should correctly identify string input
      √ should correctly identify Gemini form input (1 ms)
      √ should correctly identify legacy params input (1 ms)
  ImageGenerationFormSchema
    √ should validate theme length (1 ms)
    √ should require learningGroup
    √ should accept optional boolean fields
  LegacyParamsSchema
    √ should require prompt (1 ms)
    √ should validate size enum (1 ms)
    √ should validate quality enum (1 ms)
    √ should validate style enum (1 ms)

2025-10-21 07:31:25 [[31m[31merror[31m[39m]: [31m[31mChat health check error[31m[39m{
  "error": "Test error"
}
Error: Test error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\chat.test.ts:196:55)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
PASS src/routes/chat.test.ts (8.375 s)
  Chat Routes
    POST /api/chat
      √ should return successful chat response with valid input (252 ms)
      √ should return validation error for missing messages (15 ms)
      √ should return validation error for empty messages array (11 ms)
      √ should return validation error for invalid role (12 ms)
      √ should return validation error for empty content (13 ms)
      √ should return validation error for invalid temperature (14 ms)
      √ should handle OpenAI API errors (10 ms)
    GET /api/chat/models
      √ should return available OpenAI models (12 ms)
    GET /api/chat/health
      √ should return healthy status when service is working (11 ms)
      √ should return unhealthy status when service fails (12 ms)
      √ should handle service errors (12 ms)

2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mFile uploaded to OpenAI successfully with German umlauts[32m[39m{
  "fileId": "file-AubJQUHQ9d6dJ4BTEMPLgK",
  "openaiFilename": "test.txt",
  "originalFilename": "test.txt",
  "status": "processed"
}
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mFile uploaded successfully: file-AubJQUHQ9d6dJ4BTEMPLgK[32m[39m
2025-10-21 07:31:27 [[31m[31merror[31m[39m]: [31m[31mFile upload failed: No file provided[31m[39m{
  "error": "No file uploaded"
}
Error: No file uploaded
    at processFileUpload (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\files.ts:99:9)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\route.js:157:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\files.ts:89:5
    at multerMiddleware (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\multer\lib\make-middleware.js:19:41)
    at handleFileUpload (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\files.ts:63:24)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\route.js:157:13)
    at Route.dispatch (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\route.js:117:3)
    at handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:435:11)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:295:15
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at Function.handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:186:3)
    at router (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:60:12)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at trimPrefix (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:342:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:297:9
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:688:15
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:276:14)
    at Function.handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:186:3)
    at router (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:60:12)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at trimPrefix (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:342:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:297:9
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:688:15
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:276:14)
    at Function.handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:186:3)
    at router (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:60:12)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at trimPrefix (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:342:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:297:9
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at Function.handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:186:3)
    at router (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:60:12)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at trimPrefix (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:342:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:297:9
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\express-rate-limit\dist\index.cjs:797:9
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\express-rate-limit\dist\index.cjs:782:5
PASS src/routes/files.test.ts (10.993 s)
  POST /api/files/upload
    √ should upload a file and return a file object (2975 ms)
    √ should return an error if no file is uploaded (21 ms)

2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
PASS src/tests/performance.test.ts (37.217 s)
  Performance and Load Testing
    API Response Time Performance
      √ agent discovery should respond quickly (107 ms)
      √ execution status should respond quickly (40 ms)
      ○ skipped usage tracking should respond quickly
      ○ skipped artifact retrieval should respond quickly
    Concurrent Request Performance
      √ should handle concurrent agent discovery requests (66 ms)
      ○ skipped should handle concurrent usage tracking requests
      ○ skipped should handle mixed concurrent requests
    Memory and Resource Performance
      √ should handle large parameter payloads efficiently (28 ms)
      ○ skipped should handle many small requests efficiently
    Stress Testing
      √ should recover from peak load scenarios (635 ms)
      ○ skipped should maintain performance under sustained load
    Database Performance
      ○ skipped should handle usage tracking queries efficiently
      ○ skipped should handle artifact queries efficiently
    Performance Benchmarks
      √ should meet performance SLA requirements (1 ms)
      √ should provide performance baseline for monitoring (1 ms)

PASS src/agents/__tests__/imageGenerationAgent.test.ts (85.772 s)
  ImageGenerationAgent - OpenAI SDK
    Agent Metadata
      √ should have correct agent metadata (18 ms)
      √ should have appropriate triggers (4 ms)
      √ should have correct default config (3 ms)
    validateParams()
      √ should validate valid parameters (1 ms)
      √ should reject missing prompt (1 ms)
      √ should reject non-string prompt (1 ms)
      √ should reject empty prompt (1 ms)
      √ should reject prompt exceeding 1000 characters (1 ms)
      √ should reject invalid size (1 ms)
      √ should accept all valid sizes (2 ms)
      √ should reject invalid quality (1 ms)
      √ should accept valid qualities (1 ms)
      √ should reject invalid style (1 ms)
      √ should accept valid styles (1 ms)
    execute() - Basic Flow
      √ should execute successfully with minimal params (39 ms)
      √ should fail if SDK not configured (171 ms)
      √ should fail if prompt is missing (1 ms)
      √ should fail if prompt is too long (1 ms)
      √ should fail if user limit exceeded (1 ms)
    execute() - All Parameter Combinations
      √ should handle all size options (8 ms)
      √ should handle all quality options (2 ms)
      √ should handle all style options (3 ms)
      √ should handle educational context parameters (2 ms)
      √ should handle Gemini form input (3 ms)
    generateImage() - Test Mode
      √ should bypass OpenAI in test mode (3 ms)
      √ should call OpenAI in production mode (3 ms)
    generateImage() - Timeout Handling
      √ should timeout after 60 seconds (60014 ms)
      √ should succeed if image generation completes within timeout (1010 ms)
    generateTitleAndTags() - with Fallback
      √ should generate title and tags via ChatGPT (1 ms)
      √ should use fallback if ChatGPT fails (2 ms)
      √ should use fallback if ChatGPT returns invalid JSON (3 ms)
      √ should limit tags to 5 maximum (1 ms)
      √ should extract educational keywords in fallback (1 ms)
    buildImagePrompt() - Gemini Integration
      √ should build prompt from Gemini form input (3 ms)
      √ should handle all image styles (1 ms)
    enhanceGermanPrompt()
      √ should enhance German prompts
      √ should not enhance English prompts
      √ should handle enhancement failure gracefully (1 ms)
    Error Handling
      √ should handle DALL-E API errors (1 ms)
      √ should return German error messages (2 ms)
      √ should handle missing image URL from DALL-E (1 ms)
    canExecute() - User Limits
      √ should allow execution within limit
      √ should block execution at limit
      √ should allow execution if no usage data
      √ should handle getUserUsage errors gracefully
    estimateCost()
      √ should estimate cost for standard 1024x1024
      √ should estimate cost for hd 1024x1024
      √ should estimate cost for standard portrait
      √ should estimate cost for hd landscape
      √ should use default values if not specified (1 ms)
    Artifact Creation
      √ should create artifact with all metadata (1 ms)
      √ should include originalParams for regeneration (1 ms)
    estimateExecutionTime()
      √ should estimate execution time correctly

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 11 skipped, 28 passed, 28 of 39 total
Tests:       293 skipped, 454 passed, 747 total
Snapshots:   0 total
Time:        88.503 s
Ran all test suites.
