
> teacher-assistant-backend@1.0.0 test
> jest

2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mLogger initialized[32m[39m{
  "transports": [
    "Console",
    "ExceptionStream",
    "RejectionStream"
  ]
}
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [quota_exceeded] on attempt 1[31m[39m{
  "error": "Quota exceeded"
}
Error: Quota exceeded
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:130:26)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - quota_exceeded[32m[39m
2025-10-21 07:31:16 [[33m[33mwarn[33m[39m]: [33m[33mError escalated after 1 attempts: quota_exceeded[33m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [invalid_input] on attempt 1[31m[39m{
  "error": "Invalid input provided"
}
Error: Invalid input provided
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:147:26)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - invalid_input[32m[39m
2025-10-21 07:31:16 [[33m[33mwarn[33m[39m]: [33m[33mError escalated after 1 attempts: invalid_input[33m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [network_error] on attempt 4[31m[39m{
  "error": "Network error"
}
Error: Network error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:164:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - network_error[32m[39m
2025-10-21 07:31:16 [[33m[33mwarn[33m[39m]: [33m[33mError escalated after 4 attempts: network_error[33m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [unknown] on attempt 2[31m[39m{
  "error": "Unknown error"
}
Error: Unknown error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:182:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - unknown[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mFailed to check rate limit[31m[39m{
  "error": "Redis connection failed"
}
Error: Redis connection failed
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:238:9)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mFailed to get error statistics[31m[39m{
  "error": "Redis connection failed"
}
Error: Redis connection failed
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:274:9)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [network_error] on attempt 1[31m[39m{
  "error": "Network error"
}
Error: Network error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:315:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - network_error[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [unknown] on attempt 1[31m[39m{
  "error": "Test error for context storage"
}
Error: Test error for context storage
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:336:25)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - unknown[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [network_error] on attempt 2[31m[39m{
  "error": "Network error"
}
Error: Network error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:362:25)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - network_error[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [unknown] on attempt 1[31m[39m{
  "error": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
}
Error: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:399:25)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context: test-operation-123 - unknown[32m[39m
2025-10-21 07:31:16 [[31m[31merror[31m[39m]: [31m[31mAgent error [unknown] on attempt 1[31m[39m{
  "error": "Test error"
}
Error: Test error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\tests\errorHandlingService.test.ts:414:25)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:16 [[32m[32minfo[32m[39m]: [32m[32mStored error context:  - unknown[32m[39m
PASS src/tests/errorHandlingService.test.ts (25.266 s)
  Error Handling Service
    Error Classification
      âˆš should classify rate limit errors correctly (64 ms)
      âˆš should classify quota exceeded errors correctly (2 ms)
      âˆš should classify API key errors correctly (1 ms)
      âˆš should classify network errors correctly (1 ms)
      âˆš should classify timeout errors correctly (1 ms)
      âˆš should classify validation errors correctly (1 ms)
      âˆš should classify unknown errors as UNKNOWN (1 ms)
    Error Recovery Strategies
      âˆš should not retry for quota exceeded errors (246 ms)
      âˆš should not retry for user input errors (5 ms)
      âˆš should escalate after maximum retry attempts (5 ms)
      âˆš should provide fallback for retryable errors within limits (20 ms)
      â—‹ skipped should provide retry strategy for rate limit errors
    Rate Limiting
      âˆš should check rate limiting correctly (2 ms)
      âˆš should increment error count for rate limiting (18 ms)
      âˆš should handle rate limiting check failures gracefully (3 ms)
    Error Statistics
      âˆš should get error statistics for different time ranges (10 ms)
      âˆš should handle statistics retrieval failures gracefully (3 ms)
    German Error Messages
      âˆš should provide appropriate retry messages with delay information (4 ms)
      â—‹ skipped should provide German error messages for different error types
    Recovery Context Storage
      âˆš should store error context for analysis (6 ms)
      âˆš should track retry attempts (3 ms)
    Edge Cases and Error Handling
      âˆš should handle very long error messages appropriately (3 ms)
      âˆš should handle empty operation IDs gracefully (3 ms)
      â—‹ skipped should handle malformed error objects gracefully

2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "401 {\"error\":{\"message\":\"Invalid API key\"}}",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Test message"
      }
    ]
  }
}
Error: 401 {"error":{"message":"Invalid API key"}}
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:152:24)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "429 {\"error\":{\"message\":\"Rate limit exceeded\"}}",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Test message"
      }
    ]
  }
}
Error: 429 {"error":{"message":"Rate limit exceeded"}}
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:178:24)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "Network error",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Test message"
      }
    ]
  }
}
Error: Network error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:204:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "Generic error",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Test message"
      }
    ]
  }
}
Error: Generic error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:230:28)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:17 [[31m[31merror[31m[39m]: [31m[31mChatService error occurred[31m[39m{
  "error": "500 {\"error\":{\"message\":\"Test error\"}}",
  "request": {
    "messages": [
      {
        "role": "user",
        "content": "Say \"Hello\" to test the service."
      }
    ],
    "model": "gpt-4o-mini",
    "max_tokens": 10,
    "temperature": 0
  }
}
Error: 500 {"error":{"message":"Test error"}}
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\services\chatService.test.ts:274:24)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
PASS src/services/chatService.test.ts
  ChatService
    createChatCompletion
      âˆš should return successful response with valid OpenAI response (16 ms)
      âˆš should handle empty choices response (4 ms)
      âˆš should handle empty message content (2 ms)
      âˆš should handle OpenAI API 401 error (invalid API key) (69 ms)
      âˆš should handle OpenAI API 429 error (rate limit) (20 ms)
      âˆš should handle network errors (6 ms)
      âˆš should handle generic errors (4 ms)
      â—‹ skipped should add system message if not present
    testService
      âˆš should return true when service test succeeds (1 ms)
      âˆš should return false when service test fails (4 ms)

2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:17 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:19 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 24,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 35,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "edit_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 0
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 32,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 31,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
PASS src/routes/__tests__/agentsSdk.test.ts
  POST /api/agents-sdk/test
    TEST-015: Endpoint Returns Test Agent Response
      â—‹ skipped Endpoint returns test agent response
      â—‹ skipped Endpoint includes timestamp in response
      â—‹ skipped Endpoint returns correct content-type
      â—‹ skipped Endpoint includes SDK version
    TEST-016: Input Validation
      â—‹ skipped Rejects malformed JSON
      â—‹ skipped Validates Content-Type header
      â—‹ skipped Accepts valid empty JSON object
      â—‹ skipped Accepts JSON with optional parameters
    TEST-017: Error Handling
      â—‹ skipped Returns 500 on internal error
      â—‹ skipped Error response follows consistent format
      â—‹ skipped Error response includes timestamp
    TEST-018: Route Registration
      â—‹ skipped Route exists at correct path
      â—‹ skipped Route uses /api/agents-sdk prefix
  GET /api/agents-sdk/health
    Health Check Endpoint
      âˆš Health endpoint returns SDK status (156 ms)
      âˆš Health endpoint returns correct SDK version (34 ms)
      âˆš Health endpoint includes timestamp (18 ms)
      âˆš Health endpoint returns JSON (33 ms)

2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 0
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": true
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 1,
  "overridden": true,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 15,
  "hasOverride": true
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "edit_image",
  "confidence": 1,
  "overridden": true,
  "durationMs": 1
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 15,
  "hasOverride": true
}
2025-10-21 07:31:20 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "unknown",
  "confidence": 1,
  "overridden": true,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 11,
  "hasOverride": false
}
2025-10-21 07:31:21 [[31m[31merror[31m[39m]: [31m[31mPOST /api/agents-sdk/router/classify - Agent execution failed[31m[39m{
  "error": "Test error"
}
Error: Test error
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\agentsSdk.ts:224:11
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 15,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 0
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 15,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 24,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 14,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 2
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[31m[31merror[31m[39m]: [31m[31mFailed to cleanup Redis test data[31m[39m{
  "error": "Reached the max retries per request limit (which is 1). Refer to \"maxRetriesPerRequest\" option for details."
}
MaxRetriesPerRequestError: Reached the max retries per request limit (which is 1). Refer to "maxRetriesPerRequest" option for details.
    at Socket.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\ioredis\built\redis\event_handler.js:182:37)
    at Object.onceWrapper (node:events:633:26)
    at Socket.emit (node:events:518:28)
    at TCP.<anonymous> (node:net:351:12)
PASS src/tests/redis.integration.test.ts
  Redis Integration Tests
    Redis Connection
      âˆš should connect to Redis successfully (75 ms)
      âˆš should handle connection failures gracefully (1046 ms)
      âˆš should provide health check information (24 ms)
    Checkpoint Storage and Retrieval
      âˆš should store checkpoint data successfully (7 ms)
      âˆš should retrieve checkpoint data successfully (11 ms)
      âˆš should handle checkpoint updates correctly (6 ms)
      âˆš should handle checkpoint expiration correctly (11 ms)
    State Persistence and Recovery
      âˆš should persist execution state across connection restarts (20 ms)
      âˆš should handle failed state recovery gracefully (13 ms)
      âˆš should handle corrupted checkpoint data (5 ms)
    Performance and Concurrency
      âˆš should handle multiple concurrent checkpoint operations (10 ms)
      âˆš should measure checkpoint storage performance (28 ms)
    Memory and Resource Management
      âˆš should handle memory usage efficiently (12 ms)
      âˆš should handle Redis resource limits gracefully (14 ms)
    Error Scenarios and Recovery
      âˆš should handle network interruptions (4 ms)
      âˆš should provide meaningful error messages (1024 ms)

2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 0
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 3,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Request received[32m[39m{
  "promptLength": 1998,
  "hasOverride": false
}
2025-10-21 07:31:21 [[32m[32minfo[32m[39m]: [32m[32mPOST /api/agents-sdk/router/classify - Success[32m[39m{
  "intent": "create_image",
  "confidence": 0.95,
  "overridden": false,
  "durationMs": 1
}
PASS src/routes/__tests__/routerEndpoint.test.ts
  Router Endpoint Integration Tests
    POST /api/agents-sdk/router/classify
      âˆš should classify create_image intent successfully (350 ms)
      âˆš should classify edit_image intent successfully (28 ms)
      âˆš should handle German prompts (19 ms)
      âˆš should return entities in response (28 ms)
      âˆš should include reasoning in response (20 ms)
      âˆš should provide confidence score (18 ms)
    Manual Override Functionality
      âˆš should accept manual override to create_image (18 ms)
      âˆš should accept manual override to edit_image (16 ms)
      âˆš should accept manual override to unknown (36 ms)
      âˆš should reject invalid override value (39 ms)
    Request Validation
      âˆš should reject missing prompt (13 ms)
      âˆš should reject empty prompt (19 ms)
      âˆš should reject whitespace-only prompt (26 ms)
      âˆš should reject prompt that is too short (20 ms)
      âˆš should reject prompt that is too long (15 ms)
      âˆš should reject non-string prompt (14 ms)
      âˆš should reject invalid JSON body (38 ms)
    Error Handling
      âˆš should return German error messages (12 ms)
      âˆš should include timestamp in error response (23 ms)
      âˆš should handle agent execution failure gracefully (38 ms)
    Response Format
      âˆš should return standardized success response format (42 ms)
      âˆš should return standardized error response format (14 ms)
      âˆš should have correct content-type header (22 ms)
    Performance
      âˆš should respond within reasonable time (12 ms)
      âˆš should handle multiple concurrent requests (96 ms)
    Edge Cases
      âˆš should handle prompt with special characters (22 ms)
      âˆš should handle prompt with unicode characters (36 ms)
      âˆš should handle prompt with line breaks (19 ms)
      âˆš should handle very short valid prompt (20 ms)
      âˆš should handle maximum length prompt (13 ms)

PASS src/routes/__tests__/agentsSdkImageGeneration.test.ts
  POST /api/agents-sdk/image/generate
    Successful Requests
      âˆš should generate image with minimal parameters (576 ms)
      âˆš should accept all size parameters (77 ms)
      âˆš should accept all quality parameters (37 ms)
      âˆš should accept all style parameters (36 ms)
      âˆš should accept educational context parameters (32 ms)
      âˆš should accept Gemini form input with description (27 ms)
      âˆš should accept all imageStyle values (98 ms)
      âˆš should handle enhancePrompt flag (21 ms)
      âˆš should use prompt when both prompt and description provided (20 ms)
    Validation Errors (400)
      âˆš should reject request with no prompt and no description (26 ms)
      âˆš should reject prompt shorter than 3 characters (20 ms)
      âˆš should reject prompt longer than 1000 characters (20 ms)
      âˆš should reject invalid size (20 ms)
      âˆš should reject invalid quality (18 ms)
      âˆš should reject invalid style (22 ms)
      âˆš should reject invalid imageStyle (37 ms)
      âˆš should reject non-string prompt (36 ms)
      âˆš should trim whitespace and validate (18 ms)
    Agent Execution Errors (500)
      âˆš should return 500 if agent execution fails (18 ms)
      âˆš should return 500 if agent throws exception (13 ms)
      âˆš should handle OpenAI rate limit errors (52 ms)
      âˆš should handle quota exceeded errors (22 ms)
      âˆš should handle content policy violations (12 ms)
    Response Format
      âˆš should return complete response structure (37 ms)
      âˆš should include timestamp in all responses (48 ms)
      âˆš should include timestamp in error responses (22 ms)
    Request Logging
      âˆš should log request details (26 ms)
      âˆš should pass userId from request context if available (14 ms)
    Edge Cases
      âˆš should handle empty optional fields (22 ms)
      âˆš should handle special characters in prompt (25 ms)
      âˆš should handle German umlauts in prompt (14 ms)
      âˆš should handle very long valid prompts (15 ms)
      âˆš should handle mixed Gemini and legacy parameters (14 ms)
    Test Mode Support
      âˆš should work in test mode (17 ms)

PASS src/services/summaryService.test.ts
  SummaryService
    generateSummary
      âˆš should generate a summary â‰¤20 characters (5 ms)
      âˆš should enforce 20-character limit on long summaries (2 ms)
      âˆš should return fallback text on OpenAI API error (3 ms)
      âˆš should return "Neuer Chat" for empty messages array (2 ms)
      âˆš should use only first 4 messages for context (14 ms)
      âˆš should call OpenAI with correct parameters (1 ms)
    generateSummaryWithRetry
      âˆš should return summary on first attempt success (2 ms)
      âˆš should retry on first attempt failure and succeed on second attempt (519 ms)
      âˆš should return fallback text after both attempts fail (517 ms)
    validateSummaryLength
      âˆš should return true for valid summaries (1 ms)
      âˆš should return false for invalid summaries (1 ms)
    buildPrompt (via integration)
      âˆš should format messages correctly in prompt (1 ms)

PASS src/routes/chat-summary.test.ts
  Chat Summary API Routes
    POST /chat/summary
      âˆš should generate and store a summary successfully (219 ms)
      âˆš should return 400 if chatId is missing (15 ms)
      âˆš should return 400 if messages is missing (20 ms)
      âˆš should return 400 if messages is not an array (58 ms)
      âˆš should return 400 if messages array is empty (24 ms)
      âˆš should return 400 if message has invalid structure (14 ms)
      âˆš should return 400 if message has invalid role (20 ms)
      âˆš should limit messages to first 4 for summary generation (14 ms)
      âˆš should return 500 if summary generation throws an error (16 ms)
      âˆš should still return summary even if database update fails (55 ms)
      âˆš should handle summary with special characters (18 ms)
    GET /chat/:chatId/summary
      âˆš should return placeholder response (endpoint implementation pending) (21 ms)
      âˆš should handle missing chatId parameter (15 ms)
    Integration Flow
      âˆš should handle complete flow: validate -> generate -> store -> respond (13 ms)

PASS src/routes/chatTags.test.ts
  Chat Tags API Routes
    POST /api/chat/:chatId/tags
      âˆš should extract and save tags for a chat session (205 ms)
      âˆš should return 400 when chat ID is missing (20 ms)
      âˆš should return 503 when InstantDB is unavailable (42 ms)
      âˆš should return 404 when chat session is not found (45 ms)
      âˆš should return 400 when chat has no messages (17 ms)
      âˆš should return success with empty tags when no tags extracted (62 ms)
      âˆš should return 500 when tag saving fails (19 ms)
    PUT /api/chat/:chatId/tags
      âˆš should manually update tags (33 ms)
      âˆš should return 400 when tags are not an array (30 ms)
      âˆš should return 400 when tag structure is invalid (28 ms)
      âˆš should limit tags to 5 (13 ms)
    DELETE /api/chat/:chatId/tags
      âˆš should remove tags from chat session (29 ms)
      âˆš should return 503 when InstantDB is unavailable (17 ms)
      âˆš should return 500 when deletion fails (46 ms)
    GET /api/chat/:chatId/tags
      âˆš should retrieve tags for chat session (24 ms)
      âˆš should return 503 when InstantDB is unavailable (15 ms)

PASS src/routes/materials.test.ts
  Materials Management Routes
    POST /api/materials/update-title
      Manual artifacts
        âˆš should successfully update a manual artifact title (79 ms)
        âˆš should return 404 if manual artifact not found (39 ms)
      Generated artifacts
        âˆš should successfully update a generated artifact title (28 ms)
        âˆš should return 404 if generated artifact not found (14 ms)
      Upload title change rejection
        âˆš should reject title change for uploads (13 ms)
      Validation
        âˆš should reject request with missing materialId (22 ms)
        âˆš should reject request with missing newTitle (35 ms)
        âˆš should reject request with missing source (16 ms)
        âˆš should reject request with empty title (13 ms)
        âˆš should reject request with invalid source type (15 ms)
      Database availability
        âˆš should return 503 if InstantDB is not available (13 ms)
      Error handling
        âˆš should handle database errors gracefully (21 ms)
    DELETE /api/materials/:id
      Manual artifacts
        âˆš should successfully delete a manual artifact (15 ms)
        âˆš should return 404 if manual artifact not found (30 ms)
      Generated artifacts
        âˆš should successfully delete a generated artifact (12 ms)
        âˆš should return 404 if generated artifact not found (40 ms)
      Upload deletion rejection
        âˆš should reject deletion for uploads (20 ms)
      Validation
        âˆš should reject request with missing source parameter (14 ms)
        âˆš should reject request with invalid source type (18 ms)
      Database availability
        âˆš should return 503 if InstantDB is not available (39 ms)
      Error handling
        âˆš should handle database errors gracefully (18 ms)
    Integration Tests
      âˆš should support complete workflow: update title then delete (44 ms)
      âˆš should handle mixed material types independently (26 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
PASS src/routes/profile.test.ts
  POST /profile/extract
    âˆš should extract characteristics with valid request (30 ms)
    âˆš should return 400 with missing userId (16 ms)
    âˆš should return 400 with missing messages (38 ms)
    âˆš should return 400 with insufficient messages (< 2) (53 ms)
    âˆš should return 500 on service error (12 ms)
  GET /profile/characteristics
    âˆš should return filtered characteristics (count >= 3) (19 ms)
    âˆš should return 400 with missing userId (12 ms)
    âˆš should return 500 on service error (13 ms)
  POST /profile/characteristics/add
    âˆš should add manual characteristic successfully (15 ms)
    âˆš should trim whitespace from characteristic (12 ms)
    âˆš should return 400 with missing userId (16 ms)
    âˆš should return 400 with missing characteristic (12 ms)
    âˆš should return 400 with empty characteristic (17 ms)
    âˆš should return 500 on service error (11 ms)
  POST /profile/characteristics/categorize
    âˆš should categorize uncategorized characteristics (12 ms)
    âˆš should return 400 with missing userId (9 ms)
    âˆš should return 503 when InstantDB not available (10 ms)
    âˆš should handle partial failures gracefully (11 ms)
    âˆš should return 500 on service error (11 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 24,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 32,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 2
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 35,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 35,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "unknown",
  "confidence": 0.3,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 31,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 41,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 35,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 13,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 83,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 24,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 17,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "unknown",
  "confidence": 0.3,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 14,
  "hasOverride": true
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent using manual override[32m[39m{
  "overrideIntent": "create_image"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 15,
  "hasOverride": true
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent using manual override[32m[39m{
  "overrideIntent": "edit_image"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 15,
  "hasOverride": true
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent using manual override[32m[39m{
  "overrideIntent": "unknown"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 28,
  "hasOverride": true
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent using manual override[32m[39m{
  "overrideIntent": "create_image"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 0,
  "hasOverride": false
}
2025-10-21 07:31:24 [[31m[31merror[31m[39m]: [31m[31mRouterAgent execution failed[31m[39m{
  "error": "Prompt cannot be empty"
}
Error: Prompt cannot be empty
    at RouterAgent.execute (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\routerAgent.ts:108:15)
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\__tests__\routerAgent.test.ts:303:40)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 3,
  "hasOverride": false
}
2025-10-21 07:31:24 [[31m[31merror[31m[39m]: [31m[31mRouterAgent execution failed[31m[39m{
  "error": "Prompt cannot be empty"
}
Error: Prompt cannot be empty
    at RouterAgent.execute (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\routerAgent.ts:108:15)
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\__tests__\routerAgent.test.ts:315:40)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 0,
  "hasOverride": false
}
2025-10-21 07:31:24 [[31m[31merror[31m[39m]: [31m[31mRouterAgent execution failed[31m[39m{
  "error": "Prompt cannot be empty"
}
Error: Prompt cannot be empty
    at RouterAgent.execute (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\routerAgent.ts:108:15)
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\agents\__tests__\routerAgent.test.ts:326:40)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 619,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 3
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 30,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 41,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 49,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 55,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.92,
  "executionTimeMs": 1
}
PASS src/services/profileExtractionService.test.ts
  ProfileExtractionService
    extractCharacteristics
      âˆš should extract 2-3 characteristics from valid chat (25 ms)
      âˆš should handle empty/short chats gracefully (1 ms)
      âˆš should limit extraction to max 3 characteristics (1 ms)
      âˆš should handle OpenAI API failure gracefully (1 ms)
      âˆš should handle invalid JSON response from OpenAI (1 ms)
      âˆš should avoid duplicate characteristics (1 ms)
    categorizeCharacteristic
      âˆš should categorize subjects correctly
      âˆš should categorize grade levels correctly (1 ms)
      âˆš should categorize teaching styles correctly (1 ms)
      âˆš should categorize school types correctly (1 ms)
      âˆš should categorize topics correctly
      âˆš should default to uncategorized for invalid category (1 ms)
      âˆš should default to uncategorized on OpenAI error (1 ms)
      âˆš should return uncategorized for case mismatch (1 ms)
    buildExtractionPrompt
      âˆš should build prompt with conversation and existing profile (2 ms)
      âˆš should handle empty existing profile (1 ms)
      âˆš should limit conversation to last 10 messages (1 ms)
    error handling and edge cases
      âˆš should handle missing userId (1 ms)
      âˆš should handle null messages array (1 ms)
      âˆš should continue processing even if one characteristic fails to increment (1 ms)

PASS src/agents/__tests__/routerAgent.test.ts
  RouterAgent Unit Tests
    Initialization
      âˆš should initialize with correct properties (14 ms)
      âˆš should have correct default confidence threshold (2 ms)
    Intent Classification
      âˆš should classify create_image intent from English prompt (9 ms)
      âˆš should classify create_image intent from German prompt (4 ms)
      âˆš should classify edit_image intent from English prompt (27 ms)
      âˆš should classify edit_image intent from German prompt (7 ms)
      âˆš should return unknown for ambiguous prompts (2 ms)
      âˆš should provide reasoning for classification (3 ms)
    Entity Extraction
      âˆš should extract subject from prompt (3 ms)
      âˆš should extract grade level from prompt (3 ms)
      âˆš should extract German grade level (3 ms)
      âˆš should extract topic from prompt (2 ms)
      âˆš should extract style from prompt (3 ms)
      âˆš should handle prompts without entities (2 ms)
      âˆš should extract multiple entities from complex prompt (3 ms)
    Confidence Scores
      âˆš should provide confidence score between 0 and 1 (3 ms)
      âˆš should have high confidence for clear prompts (3 ms)
      âˆš should have lower confidence for ambiguous prompts (1 ms)
    Manual Override
      âˆš should respect manual override to create_image (3 ms)
      âˆš should respect manual override to edit_image (4 ms)
      âˆš should respect manual override to unknown (3 ms)
      âˆš should still extract entities with override (3 ms)
    Error Handling
      âˆš should reject empty prompt (67 ms)
      âˆš should reject whitespace-only prompt (3 ms)
      âˆš should format error messages in German (3 ms)
    Parameter Validation
      âˆš should validate valid parameters (2 ms)
      âˆš should validate parameters with override (1 ms)
      âˆš should reject empty prompt in validation (1 ms)
      âˆš should reject non-string prompt (2 ms)
      âˆš should reject invalid override value (7 ms)
    Execution Time Estimation
      âˆš should provide reasonable execution time estimate (2 ms)
    Edge Cases
      âˆš should handle very long prompts (2 ms)
      âˆš should handle prompts with special characters (5 ms)
      âˆš should handle multilingual prompts (2 ms)
      âˆš should handle prompts with numbers and dates (2 ms)
    Multiple Keywords
      âˆš should handle prompts with both create and edit keywords (2 ms)
      âˆš should prioritize stronger keywords (1 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 4
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 2
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 63,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.875,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 25
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 53,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 61,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 56,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 49,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.75,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 54,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8450000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 5
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 49,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.92,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 58,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 55,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.935,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 70,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 37,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 47,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 27,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 25,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 61,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 41,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 47,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.875,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 59,
  "hasOverride": false
}
PASS src/agents/langGraphImageGenerationAgent.test.ts
  LangGraphImageGenerationAgent - buildPrompt
    buildPrompt()
      â—‹ skipped should create basic prompt without DaZ or learning difficulties
      â—‹ skipped should include DaZ considerations when enabled
      â—‹ skipped should include learning difficulties considerations when enabled
      â—‹ skipped should include both DaZ and learning difficulties when both enabled
      â—‹ skipped should always include style guidelines
      â—‹ skipped should handle special characters in description correctly
      â—‹ skipped should handle different learning groups correctly
    execute() - Gemini Integration
      â—‹ skipped should detect Gemini input and use buildPrompt
      â—‹ skipped should use old enhancement method when Gemini params not present
    Prompt Output Validation
      â—‹ skipped should produce prompt with correct structure
      â—‹ skipped should produce prompt that is not too long for DALL-E
  LangGraphImageGenerationAgent - Auto-Tagging (TASK-018)
    generateTitleAndTags
      âˆš should generate title and tags using ChatGPT (28 ms)
      âˆš should limit tags to 5 maximum (8 ms)
      âˆš should use fallback if ChatGPT fails (84 ms)
      âˆš should extract educational keywords in fallback (5 ms)
      â—‹ skipped should work with Gemini form input
    Artifact creation with tags
      âˆš should include tags in artifact_data (2 ms)
      âˆš should include tags in metadata for searchability (2 ms)
    Title generation
      âˆš should generate concise German titles (2 ms)
    Error handling
      âˆš should handle invalid JSON response from ChatGPT (4 ms)
      âˆš should handle empty ChatGPT response (3 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 41,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 54,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 67,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 49,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 48,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.92,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 51,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.7,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 54,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8450000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 53,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 47,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 34,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 47,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 58,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 54,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 59,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 66,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.92,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 51,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 56,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 38,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 53,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.7,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 63,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.875,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 63,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 2
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 10
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.875,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 2
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 43,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 63,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.905,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
PASS src/tests/langGraphAgentService.test.ts (7.358 s)
  LangGraph Agent Service
    Service Initialization
      â—‹ skipped should initialize LangGraph service successfully
      â—‹ skipped should register LangGraph agents
    Agent Workflow Execution
      â—‹ skipped should execute image generation agent with workflow
      â—‹ skipped should handle validation errors properly
      â—‹ skipped should handle non-existent agent gracefully
      â—‹ skipped should support different progress levels
    Error Handling and Recovery
      â—‹ skipped should handle OpenAI API errors with recovery
      â—‹ skipped should preserve credits on failure
    Execution Status Tracking
      â—‹ skipped should track execution status
      â—‹ skipped should support execution cancellation
    Agent Parameter Validation
      â—‹ skipped should validate image generation parameters correctly
      â—‹ skipped should estimate costs correctly
    Educational Enhancement Features
      â—‹ skipped should enhance German prompts for educational context
      â—‹ skipped should handle English prompts without unnecessary enhancement
    Progress Streaming Integration
      â—‹ skipped should create progress tracker for executions
      â—‹ skipped should handle different progress levels correctly
  LangGraph Image Generation Agent
    âˆš should create workflow successfully (12 ms)
    âˆš should have correct workflow configuration (3 ms)
    âˆš should have all required agent properties (3 ms)
    âˆš should support educational context parameters (1 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 57,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 33,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8300000000000001,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 40,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 1
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 42,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.875,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 45,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 36,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 46,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 50,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.8600000000000001,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 52,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "create_image",
  "confidence": 0.89,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 39,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution started[32m[39m{
  "promptLength": 44,
  "hasOverride": false
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent execution completed[32m[39m{
  "success": true,
  "intent": "edit_image",
  "confidence": 0.95,
  "executionTimeMs": 0
}
PASS src/agents/__tests__/routerAccuracy.test.ts
  Router Agent Accuracy Tests
    âˆš should achieve â‰¥95% accuracy on 100-sample test dataset (119 ms)
    âˆš should correctly classify create_image intents (8 ms)
    âˆš should correctly classify edit_image intents (6 ms)
    âˆš should handle German prompts with high accuracy (22 ms)
    âˆš should handle English prompts with high accuracy (9 ms)
    âˆš should provide confidence scores â‰¥0.7 for correct classifications (14 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "einem Vulkan"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Ich brauche ein Bild fÃ¼r meine 7. Klasse zum Thema Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "den Wasserkreislauf fÃ¼r mich"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese fÃ¼r Klasse 7a"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Bild fÃ¼r 9. Klasse zum Thema Zellaufbau"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "m Thema Bruchrechnung"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "m Thema \"Der Wasserkreislauf in der Natur\""
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Klasse 7 zur Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "7. Klasse zum Thema Zellaufbau"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Klasse 7a"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Jahrgangsstufe 9 zum Thema FranzÃ¶sische Revolution"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Bruchrechnung"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "Klasse 7 zur Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "r Photosynthese"
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mImage generation intent detected[32m[39m{
  "confidence": 0.85,
  "description": "R PHOTOSYNTHESE"
}
PASS src/config/index.test.ts
  Configuration
    config object
      âˆš should have all required properties (2 ms)
      âˆš should have correct PORT type (1 ms)
      âˆš should have correct NODE_ENV (1 ms)
      âˆš should have valid FRONTEND_URL (2 ms)
      âˆš should have API_PREFIX (3 ms)
    environment helpers
      âˆš should correctly identify test environment (1 ms)
      âˆš should be boolean values (1 ms)
      âˆš should have only one environment flag as true

PASS src/services/agentIntentService.test.ts
  AgentIntentService
    detectAgentIntent
      Image Generation Intent
        âˆš should detect "erstelle ein bild" intent (18 ms)
        âˆš should detect "generiere bild" intent (4 ms)
        âˆš should detect "bild fÃ¼r" intent (2 ms)
        âˆš should detect "visualisiere" intent (2 ms)
        âˆš should extract learning group from message (1 ms)
        âˆš should extract learning group from alternative pattern (2 ms)
        âˆš should use context subject if available (2 ms)
        âˆš should use context grade as fallback (1 ms)
      Worksheet Intent
        â—‹ skipped should detect "arbeitsblatt" intent
        â—‹ skipped should detect "Ã¼bungen" intent
        â—‹ skipped should detect "aufgaben" intent
      Lesson Plan Intent
        â—‹ skipped should detect "unterrichtsplan" intent
        â—‹ skipped should detect "stundenentwurf" intent
        â—‹ skipped should detect "unterricht planen" intent
      No Intent Detection
        âˆš should return null for regular questions (1 ms)
        âˆš should return null for general teaching questions
        âˆš should return null for chat messages (1 ms)
      Theme Extraction
        âˆš should clean trigger words from theme (2 ms)
        âˆš should extract description after "zum Thema" (1 ms)
        âˆš should handle complex themes (1 ms)
        âˆš should remove trailing punctuation and politeness (1 ms)
      Learning Group Extraction
        âˆš should extract "Klasse 7" (1 ms)
        âˆš should extract "7. Klasse" (1 ms)
        âˆš should extract "Klasse 7a" with letter suffix (1 ms)
        âˆš should extract "Jahrgangsstufe 9" (2 ms)
      Context Integration
        âˆš should use teacher context for subject (2 ms)
        âˆš should prioritize message grade over context (1 ms)
        âˆš should fallback to context grade if not in message (2 ms)
      Edge Cases
        âˆš should handle empty message
        âˆš should handle very short message
        âˆš should handle message with only trigger word (1 ms)
        âˆš should handle uppercase message (2 ms)
        â—‹ skipped should handle mixed case with umlauts

PASS src/tests/agents.test.ts (33.315 s)
  Agent System Tests
    Agent Registry
      â—‹ skipped should register and retrieve agents
      â—‹ skipped should get all enabled agents
      â—‹ skipped should find agents by trigger keywords
    Image Generation Agent
      â—‹ skipped should validate correct parameters
      â—‹ skipped should reject invalid parameters
      â—‹ skipped should estimate costs correctly
      â—‹ skipped should detect German text correctly
      â—‹ skipped should generate appropriate image titles
    API Endpoints
      GET /api/agents/available
        â—‹ skipped should return available agents
      POST /api/agents/execute
        â—‹ skipped should validate required fields
        â—‹ skipped should reject non-existent agent
      POST /api/agents/image/generate
        â—‹ skipped should validate image generation parameters
        â—‹ skipped should accept valid image generation parameters
      GET /api/agents/image/usage/:userId
        â—‹ skipped should return usage information for valid user
        â—‹ skipped should validate user ID parameter
      GET /api/agents/artifacts/:userId
        â—‹ skipped should return artifacts for valid user
        â—‹ skipped should handle query parameters
        â—‹ skipped should validate limit parameter
      GET /api/agents/triggers
        â—‹ skipped should find agents by trigger text
        â—‹ skipped should require text parameter
        â—‹ skipped should handle text that matches no agents
      POST /api/agents/artifacts/:artifactId/favorite
        â—‹ skipped should validate required fields
        â—‹ skipped should accept valid favorite toggle request
    Agent Execution Service
      â—‹ skipped should handle agent execution with invalid agent ID
      â—‹ skipped should handle agent execution with invalid parameters
    Security and Validation
      â—‹ skipped should apply rate limiting
      â—‹ skipped should filter inappropriate content
  Agent Error Handling
    âˆš should handle database connection errors gracefully (45 ms)
    âˆš should handle OpenAI API errors gracefully
  Performance Tests
    âˆš should handle concurrent agent execution requests (1 ms)
    âˆš should complete image generation within reasonable time (1 ms)

PASS src/services/profileDeduplicationService.test.ts
  profileDeduplicationService
    findSimilarCharacteristics
      âˆš should find exact matches with different casing (3 ms)
      âˆš should find abbreviation matches (2 ms)
      âˆš should find typo matches (2 ms)
      âˆš should prefer longer names over abbreviations (1 ms)
      âˆš should handle multiple similar characteristics in one group (1 ms)
      âˆš should not group dissimilar characteristics (1 ms)
      âˆš should throw error when InstantDB is not available (65 ms)
    mergeSimilarCharacteristics
      âˆš should merge characteristics correctly (4 ms)
      âˆš should throw error if keep characteristic not found (2 ms)
      âˆš should throw error if merge characteristics not found (2 ms)
      âˆš should throw error when InstantDB is not available (3 ms)
    findSimilarExisting
      âˆš should find exact match (1 ms)
      âˆš should find abbreviation match (1 ms)
      âˆš should find similarity match (1 ms)
      âˆš should return null if no similar characteristic found (1 ms)
      âˆš should return null when InstantDB is not available (1 ms)
      âˆš should handle errors gracefully (1 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mProcessing file with filename[32m[39m{
  "original": "test.txt",
  "hasUmlauts": false,
  "byteLength": 8,
  "charLength": 8
}
PASS src/routes/health.test.ts (7.6 s)
  Health Routes
    GET /api/health
      âˆš should return health check data (81 ms)
      âˆš should return correct health data structure (18 ms)
      âˆš should return valid timestamp format (18 ms)
      âˆš should return environment as test (13 ms)
      âˆš should return uptime as a number (22 ms)
      âˆš should return version as string (22 ms)
      âˆš should have correct content type (12 ms)
      âˆš should be fast response (11 ms)

PASS src/app.test.ts (7.944 s)
  Express App
    GET /
      âˆš should return welcome message (115 ms)
      âˆš should return valid timestamp format (18 ms)
    API Endpoints
      âˆš should handle API routes (18 ms)
    404 Handler
      âˆš should return 404 for non-existent routes (10 ms)
      âˆš should return 404 with timestamp (24 ms)
    CORS Configuration
      âˆš should include CORS headers (25 ms)
      âˆš should handle preflight OPTIONS requests (9 ms)
    JSON Body Parsing
      âˆš should parse JSON bodies (12 ms)

2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mFile validation successful[32m[39m{
  "filename": "test.txt",
  "hasUmlauts": false,
  "byteLength": 8,
  "charLength": 8
}
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mProcessing file upload: test.txt (20 bytes)[32m[39m
2025-10-21 07:31:24 [[32m[32minfo[32m[39m]: [32m[32mUploading file to OpenAI with German umlaut support[32m[39m{
  "originalFilename": "test.txt",
  "normalizedFilename": "test.txt",
  "hasUmlauts": false,
  "fileSize": 20,
  "byteLength": 8
}
PASS src/services/chatTagService.test.ts
  ChatTagService
    extractChatTags
      âˆš should extract tags from chat messages (6 ms)
      âˆš should return empty array for empty messages (2 ms)
      âˆš should handle OpenAI API errors gracefully (1 ms)
      âˆš should handle invalid JSON responses (1 ms)
      âˆš should filter out invalid tags (1 ms)
      âˆš should limit tags to 5 (1 ms)
      âˆš should analyze only first 10 messages (1 ms)
    extractTagsFromText
      âˆš should extract tags from text (2 ms)
      âˆš should return empty array for empty text (2 ms)
    mergeTags
      âˆš should merge and deduplicate tags (2 ms)
      âˆš should limit merged tags to 5
    tagsToStringArray
      âˆš should convert tags to string array (1 ms)
    stringArrayToTags
      âˆš should convert string array to tags (1 ms)

PASS src/routes/langGraphAgents.test.ts
  LangGraph Agent Validation
    Gemini Form Format
      âˆš should accept valid Gemini form data (10 ms)
      âˆš should reject Gemini form with missing theme (2 ms)
      âˆš should reject Gemini form with short theme (4 ms)
      âˆš should accept Gemini form with optional fields defaulted (1 ms)
    Legacy Params Format
      âˆš should accept valid legacy params (1 ms)
      âˆš should reject legacy params with invalid size (1 ms)
      âˆš should reject legacy params without prompt
    Simple String Input
      âˆš should accept string input (1 ms)
      âˆš should accept input in legacy params format (1 ms)
    Edge Cases
      âˆš should reject request without agentId (1 ms)
      âˆš should accept request without userId (optional) (1 ms)
      âˆš should default progressLevel to user_friendly (1 ms)
      âˆš should default confirmExecution to false
    Multiple Input Formats (Union)
      âˆš should correctly identify string input
      âˆš should correctly identify Gemini form input (1 ms)
      âˆš should correctly identify legacy params input (1 ms)
  ImageGenerationFormSchema
    âˆš should validate theme length (1 ms)
    âˆš should require learningGroup
    âˆš should accept optional boolean fields
  LegacyParamsSchema
    âˆš should require prompt (1 ms)
    âˆš should validate size enum (1 ms)
    âˆš should validate quality enum (1 ms)
    âˆš should validate style enum (1 ms)

2025-10-21 07:31:25 [[31m[31merror[31m[39m]: [31m[31mChat health check error[31m[39m{
  "error": "Test error"
}
Error: Test error
    at Object.<anonymous> (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\chat.test.ts:196:55)
    at Promise.finally.completed (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1556:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1496:10)
    at _callCircusTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1006:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:946:3)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:839:13)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at _runTestsForDescribeBlock (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:829:11)
    at run (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:757:3)
    at runAndTransformResultsToJestFormat (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\jestAdapterInit.js:1917:21)
    at jestAdapter (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-circus\build\runner.js:101:19)
    at runTestInternal (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:275:16)
    at runTest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:343:7)
    at Object.worker (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\jest-runner\build\testWorker.js:497:12)
PASS src/routes/chat.test.ts (8.375 s)
  Chat Routes
    POST /api/chat
      âˆš should return successful chat response with valid input (252 ms)
      âˆš should return validation error for missing messages (15 ms)
      âˆš should return validation error for empty messages array (11 ms)
      âˆš should return validation error for invalid role (12 ms)
      âˆš should return validation error for empty content (13 ms)
      âˆš should return validation error for invalid temperature (14 ms)
      âˆš should handle OpenAI API errors (10 ms)
    GET /api/chat/models
      âˆš should return available OpenAI models (12 ms)
    GET /api/chat/health
      âˆš should return healthy status when service is working (11 ms)
      âˆš should return unhealthy status when service fails (12 ms)
      âˆš should handle service errors (12 ms)

2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mOpenAI Agents SDK initialized (tracing disabled for GDPR compliance)[32m[39m{
  "environment": "test"
}
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mTestAgent initialized[32m[39m{
  "id": "test-agent",
  "name": "Test Agent"
}
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mRouterAgent initialized[32m[39m{
  "id": "router-agent",
  "name": "Router Agent",
  "confidenceThreshold": 0.7
}
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mAgentExecutionService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mImageGenerationAgent initialized (OpenAI SDK)[32m[39m{
  "id": "image-generation-agent",
  "name": "Bildgenerierung",
  "monthlyLimit": 10
}
2025-10-21 07:31:26 [[32m[32minfo[32m[39m]: [32m[32mLangGraphAgentService initialized with InstantDB bypass mode[32m[39m
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mFile uploaded to OpenAI successfully with German umlauts[32m[39m{
  "fileId": "file-AubJQUHQ9d6dJ4BTEMPLgK",
  "openaiFilename": "test.txt",
  "originalFilename": "test.txt",
  "status": "processed"
}
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mFile uploaded successfully: file-AubJQUHQ9d6dJ4BTEMPLgK[32m[39m
2025-10-21 07:31:27 [[31m[31merror[31m[39m]: [31m[31mFile upload failed: No file provided[31m[39m{
  "error": "No file uploaded"
}
Error: No file uploaded
    at processFileUpload (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\files.ts:99:9)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\route.js:157:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\files.ts:89:5
    at multerMiddleware (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\multer\lib\make-middleware.js:19:41)
    at handleFileUpload (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\src\routes\files.ts:63:24)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\route.js:157:13)
    at Route.dispatch (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\route.js:117:3)
    at handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:435:11)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:295:15
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at Function.handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:186:3)
    at router (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:60:12)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at trimPrefix (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:342:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:297:9
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:688:15
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:276:14)
    at Function.handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:186:3)
    at router (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:60:12)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at trimPrefix (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:342:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:297:9
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:688:15
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:276:14)
    at Function.handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:186:3)
    at router (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:60:12)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at trimPrefix (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:342:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:297:9
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at Function.handle (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:186:3)
    at router (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:60:12)
    at Layer.handleRequest (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\lib\layer.js:152:17)
    at trimPrefix (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:342:13)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:297:9
    at processParams (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:582:12)
    at next (C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\router\index.js:291:5)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\express-rate-limit\dist\index.cjs:797:9
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at C:\Users\steff\Desktop\eduhu-pwa-prototype\teacher-assistant\backend\node_modules\express-rate-limit\dist\index.cjs:782:5
PASS src/routes/files.test.ts (10.993 s)
  POST /api/files/upload
    âˆš should upload a file and return a file object (2975 ms)
    âˆš should return an error if no file is uploaded (21 ms)

2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mAgent registered: langgraph-image-generation (Erweiterte Bildgenerierung)[32m[39m
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m{
  "appId": "39f14e13..."
}
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to messages[32m[39m{
  "entity": "messages",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32m[Schema Migration] Fields added to library_materials[32m[39m{
  "entity": "library_materials",
  "fields": [
    "metadata (json)"
  ],
  "action": "add"
}
2025-10-21 07:31:27 [[32m[32minfo[32m[39m]: [32m[32mInstantDB initialized successfully[32m[39m
PASS src/tests/performance.test.ts (37.217 s)
  Performance and Load Testing
    API Response Time Performance
      âˆš agent discovery should respond quickly (107 ms)
      âˆš execution status should respond quickly (40 ms)
      â—‹ skipped usage tracking should respond quickly
      â—‹ skipped artifact retrieval should respond quickly
    Concurrent Request Performance
      âˆš should handle concurrent agent discovery requests (66 ms)
      â—‹ skipped should handle concurrent usage tracking requests
      â—‹ skipped should handle mixed concurrent requests
    Memory and Resource Performance
      âˆš should handle large parameter payloads efficiently (28 ms)
      â—‹ skipped should handle many small requests efficiently
    Stress Testing
      âˆš should recover from peak load scenarios (635 ms)
      â—‹ skipped should maintain performance under sustained load
    Database Performance
      â—‹ skipped should handle usage tracking queries efficiently
      â—‹ skipped should handle artifact queries efficiently
    Performance Benchmarks
      âˆš should meet performance SLA requirements (1 ms)
      âˆš should provide performance baseline for monitoring (1 ms)

PASS src/agents/__tests__/imageGenerationAgent.test.ts (85.772 s)
  ImageGenerationAgent - OpenAI SDK
    Agent Metadata
      âˆš should have correct agent metadata (18 ms)
      âˆš should have appropriate triggers (4 ms)
      âˆš should have correct default config (3 ms)
    validateParams()
      âˆš should validate valid parameters (1 ms)
      âˆš should reject missing prompt (1 ms)
      âˆš should reject non-string prompt (1 ms)
      âˆš should reject empty prompt (1 ms)
      âˆš should reject prompt exceeding 1000 characters (1 ms)
      âˆš should reject invalid size (1 ms)
      âˆš should accept all valid sizes (2 ms)
      âˆš should reject invalid quality (1 ms)
      âˆš should accept valid qualities (1 ms)
      âˆš should reject invalid style (1 ms)
      âˆš should accept valid styles (1 ms)
    execute() - Basic Flow
      âˆš should execute successfully with minimal params (39 ms)
      âˆš should fail if SDK not configured (171 ms)
      âˆš should fail if prompt is missing (1 ms)
      âˆš should fail if prompt is too long (1 ms)
      âˆš should fail if user limit exceeded (1 ms)
    execute() - All Parameter Combinations
      âˆš should handle all size options (8 ms)
      âˆš should handle all quality options (2 ms)
      âˆš should handle all style options (3 ms)
      âˆš should handle educational context parameters (2 ms)
      âˆš should handle Gemini form input (3 ms)
    generateImage() - Test Mode
      âˆš should bypass OpenAI in test mode (3 ms)
      âˆš should call OpenAI in production mode (3 ms)
    generateImage() - Timeout Handling
      âˆš should timeout after 60 seconds (60014 ms)
      âˆš should succeed if image generation completes within timeout (1010 ms)
    generateTitleAndTags() - with Fallback
      âˆš should generate title and tags via ChatGPT (1 ms)
      âˆš should use fallback if ChatGPT fails (2 ms)
      âˆš should use fallback if ChatGPT returns invalid JSON (3 ms)
      âˆš should limit tags to 5 maximum (1 ms)
      âˆš should extract educational keywords in fallback (1 ms)
    buildImagePrompt() - Gemini Integration
      âˆš should build prompt from Gemini form input (3 ms)
      âˆš should handle all image styles (1 ms)
    enhanceGermanPrompt()
      âˆš should enhance German prompts
      âˆš should not enhance English prompts
      âˆš should handle enhancement failure gracefully (1 ms)
    Error Handling
      âˆš should handle DALL-E API errors (1 ms)
      âˆš should return German error messages (2 ms)
      âˆš should handle missing image URL from DALL-E (1 ms)
    canExecute() - User Limits
      âˆš should allow execution within limit
      âˆš should block execution at limit
      âˆš should allow execution if no usage data
      âˆš should handle getUserUsage errors gracefully
    estimateCost()
      âˆš should estimate cost for standard 1024x1024
      âˆš should estimate cost for hd 1024x1024
      âˆš should estimate cost for standard portrait
      âˆš should estimate cost for hd landscape
      âˆš should use default values if not specified (1 ms)
    Artifact Creation
      âˆš should create artifact with all metadata (1 ms)
      âˆš should include originalParams for regeneration (1 ms)
    estimateExecutionTime()
      âˆš should estimate execution time correctly

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 11 skipped, 28 passed, 28 of 39 total
Tests:       293 skipped, 454 passed, 747 total
Snapshots:   0 total
Time:        88.503 s
Ran all test suites.
